Javascript Absolute vs. Relative URI using .execCommand('insertHTML', false, html);
<p>I've been using a rteEditor very sucefully until now.</p> <p>The problem is in this line of code:</p> <pre><code>document.getElementById(rteName).contentWindow.document.execCommand('insertHTML', false, html); </code></pre> <p>I'm passing an ABSOLUTE path to the html var such as ("<a href="http://www.url.com/file.html" rel="nofollow noreferrer">http://www.url.com/file.html</a>").</p> <p>But when it execute this insert command the output is ("../file.html");</p> <p>Its possible to use a jQuery command instead?</p> <p>Any Suggestions?</p>
<p>Have you tried using 'insertImage' instead of 'insertHTML'?</p> <p>Edit: 'insertImage' just takes the url of the image and creates an img tag based on that.<br> You can get the image after inserting it with jQuery like <a href="http://docs.jquery.com/Selectors/attributeEquals#attributevalue" rel="nofollow noreferrer">this</a>:</p> <pre><code> var img = $("img[src='imgUrl']"); </code></pre> <p>with 'imgUrl' being the url of the image you add, and then add the needed attributes to that.</p> <p>An example without using jQuery is <a href="http://drupal.org/files/issues/jquery.wysiwyg.js_.txt" rel="nofollow noreferrer">here</a> at line 123.</p>
<p>In my experience, working with native rich text editors (aka div's with <code>contentEditable="true"</code> or iframes with <code>designMode</code> set to <code>on</code>) is very difficult. The API is inconsistent across browsers and their behavior is often unexpected and buggy. Because of this I tend to use <code>document.execCommand()</code> as little as possible. Instead I tend to reply on direct DOM manipulation.</p> <p>With that in mind, here's how I'd try to solve the problem you described:</p> <ul> <li>Create the an in-memory image element and set the appropriate url.</li> <li>Find the DOM node that contains user's cursor.</li> <li>Insert the in-memory image element into the DOM node found in the previous step.</li> </ul> <p>The code needed to implement the second step is somewhat tricky and varies hugely across browsers. I'll try to post a working example in the next day or two. I hope this helps in the mean time.</p>
<p>As far as I understand, and have experienced it myself, this is 1. inherent to the browser's HTML editing engine and 2. it happens only when the image that you are trying to insert, and the address you are running the HTML editor from <strong>are on the same domain</strong>.</p> <p>As a solution, if your server/provider allows this, you could set up a second subdomain that points to <code>www</code>, for example</p> <pre><code>www2.example.com </code></pre> <p>and link to the image as</p> <pre><code>http://www2.example.com </code></pre> <p>this should have the result that the absolute link remains untouched.</p> <p>upon saving the HTML, you just have to replace all occurrences of <code>www2.example.com</code> to <code>www.example.com</code>. </p> <p>Another, maybe simpler, way would be to run the WYSIWYG editor on <code>www2.example.com</code> and inserting the proper absolute URLs. </p>
<p>I think because of security reasons, you can not specify complete url such as www.example.com.</p>
<p>I believe that you should be able to use jQuery.</p> <p>You will probably want to use something along the lines of</p> <pre><code>$(rteName).find('body').html('&lt;img src="http://www.example.com/" alt="..."&gt; </code></pre> <p>but probably with some changes to the selector(s).</p>