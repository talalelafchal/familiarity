javascript selection/range coordinates
<p>I would like to absolute-position a div on either the initial or terminal corner of a text selection, as the user drags their mouse along. Unfortunately, Range only provides the index position, not the x/y coordinates. I think there might be a way to do this with range.insertNode, but only for one side. (This might also help someone position an auto-complete box under a contenteditable.)</p> <p>How can I get the x/y coordinates of a text selection, or of the text cursor?</p>
<p>You would have to get the mouse position from the mouse move event. Then you can get the position of the text input element and do the math (make the mouse position relative).</p> <p>EDIT:</p> <p><a href="http://webscripts.softpedia.com/scriptDownload/VSK-Form-Tools-Download-39681.html" rel="nofollow noreferrer">Here is a page</a> where you can get JavaScript code that will get the caret position in pixels.</p> <p>If you want to use JQuery, you can use <a href="http://plugins.jquery.com/project/caretPosition" rel="nofollow noreferrer">this</a></p>
<p>Works in chrome/webkit, positioning the div after the last-selected letter. Usually.</p> <pre><code>&lt;html&gt;&lt;head&gt; &lt;script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"&gt;&lt;/script&gt; &lt;script&gt; var $div; var last; function find() { var selection = window.getSelection(); var text = selection.toString(); if (last==text) return; else last=text; // prevent needless computations if no changes to selection if (selection.rangeCount==0) return; var range = selection.getRangeAt(0); var $span= $("&lt;span/&gt;"); newRange = document.createRange(); newRange.setStart(selection.focusNode, range.endOffset); newRange.insertNode($span[0]); // using 'range' here instead of newRange unselects or causes flicker on chrome/webkit var x = $span.offset().left; var y = $span.offset().top; $div.text(x+" "+y); $div.css({left:x,top:y+($div.height())}); $span.remove(); } $(window).load(function() { $("body").keydown(function(e) { //find(); setTimeout(find,0); }); $("body").mousemove(function(e) { //find(); setTimeout(find,0); }); $div=$("&lt;div style='border:1px solid red;background:white; position:absolute;'&gt;").appendTo($("body")); }); &lt;/script&gt; &lt;/head&gt; &lt;body&gt;&lt;p&gt;the quick brown fox&lt;/p&gt;&lt;ul&gt;&lt;li&gt;jumps &lt;i&gt;over&lt;/i&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;the lazy dog&lt;/p&gt;&lt;/body&gt; &lt;/html&gt; </code></pre>