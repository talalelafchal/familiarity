Get the parent element of caret position inside iframe (with designmode on) in IE
<p>This is a follow-up question to the: <a href="http://stackoverflow.com/questions/1563427/how-do-i-find-out-the-dom-node-at-cursor-in-a-browsers-editable-content-window-u/1563492#1563492">How do I find out the DOM node at cursor in a browserâ€™s editable content window using Javascript?</a></p> <p>That was answered by <strong>Tim Down</strong>.</p> <p>There is a problem getting parent element of caret position (without selecting), inside iframe in IE (in firefox it works great).</p> <p>Here is the partial code from that answer:</p> <pre><code> if (ob.document.selection &amp;&amp; ob.document.selection.createRange) { range = ob.document.selection.createRange(); alert(range.parentElement().innerHTML); //I get blank return range.parentElement(); } </code></pre> <p>where ob is: </p> <pre><code>document.getElementById('myIframe').contentWindow; </code></pre> <p>The iframe's outerHtml (for testing):</p> <pre><code> "&lt;!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'&gt;" + "&lt;html xmlns='http://www.w3.org/1999/xhtml'&gt;" + "&lt;head&gt;" + "&lt;title&gt;testing&lt;/title&gt;" + "&lt;/head&gt;" + "&lt;body&gt;&lt;p&gt;some text for testing&lt;b&gt;I am bold&lt;/b&gt; more testing&lt;/p&gt;"+ "&lt;p&gt;blablabla&lt;/p&gt;" + "&lt;p&gt;121213134&lt;/p&gt;&lt;/body&gt;" + "&lt;/html&gt;"); </code></pre> <p>So when you place caret on any word, the result is "blank".</p> <p>Another issue I would like you to address:<br> if you select section inside "I am bold", the parent element that being returned is "I am bold" (the b element).<br> Is it possible to return the P element instead? (ofcourse it should work for other cases as well) </p> <p><strong>Update:</strong></p> <p>The call to the selection function is made , temporary, by a simple button that is located on document that hosts the iframe:</p> <pre><code>&lt;input type="button" value="test" onclick="getElementInRange()"/&gt; </code></pre> <p>Also there is Init() function that run at load that sets iframe's outerHTML (though i don't think it's important):</p> <pre><code>function Init() { document.getElementById('myIframe').contentWindow.document.designMode = "on"; document.getElementById('myIframe').contentWindow.document.open("text/html", "replace"); document.getElementById('myIframe').contentWindow.document.write(//*Here comes the string from above...* document.getElementById('myIframe').contentWindow.document.close(); } </code></pre> <p><strong>Update2:</strong><br> I tried adding to the button: unselectable="on", this causes strange anomaly some times it returns the right value ans some times it doesn't even if the caret in same position!!!</p> <p><strong>Update3</strong><br> after more testing I've found out that the "anomaly" happens when iframe loses focus and caret disappears from the iframe after clicking (on what state of click it happens i didn't check)the button (if it disappears the result is blank, if it stays the result is as expected).<br> So the question is how to keep caret inside iframe NO MATTER WHAT?</p>
<p>You should really try the <a href="http://closure-library.googlecode.com/svn/trunk/closure/goog/docs/class_goog_dom_AbstractRange.html" rel="nofollow noreferrer">range classes</a> from the <a href="http://code.google.com/closure/library/" rel="nofollow noreferrer">Google Closure library</a>.</p> <pre><code>goog.require('goog.dom.Range'); var range = goog.dom.Range.createFromWindow(ob); return range.getStartNode().parentNode; </code></pre>
<blockquote> <p>So the question is how to keep caret inside iframe NO MATTER WHAT?</p> </blockquote> <p>Assign a mousedown event on the button. This will be triggered before caret is removed from iframe. But it will only work once so its a good idea to save a reference to the object into a variable.</p> <pre><code>$("button").mousedown(function(){ parent = getSelectionContainerElement(); }); </code></pre>