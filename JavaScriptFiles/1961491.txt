Retrieving a closest node to the caret position
<p>I have a document (inside editable iframe),<br> I need to retrieve a closest node to the caret position, not the parent node, but the sibling node (so they must have same parent) that is located (when available) left to the caret position(collapsed selection).</p> <p>The node can be any node, like text node, paragraph, div and etc.<br> Note: the browser is <strong>not</strong> IE.</p> <p>I have this for now:</p> <pre><code> var content = document.getElementById('iframedocument').contentWindow; var selection = content.getSelection(); var range = selection.getRangeAt(0); </code></pre>
<p>Try this using <code>range.startContainer</code> or <code>range.endContainer</code>.</p> <p>There's more documentation on the range object at <a href="https://developer.mozilla.org/en/DOM/range" rel="nofollow noreferrer">https://developer.mozilla.org/en/DOM/range</a></p>
<p>This works for me:</p> <pre><code>var content = document.getElementById('iframedocument').contentWindow; var selection = content.getSelection(); var range = selection.getRangeAt(0); var container = range.endContainer; var lastNodeBeforeCaret = container.lastElementChild; while (range.comparePoint(lastNodeBeforeCaret, 0) == 1) { lastNodeBeforeCaret = lastNodeBeforeCaret.previousSibling; } </code></pre> <p>Another question, firefox adds one or two </p> <pre><code>&lt;br _moz_dirty=""/&gt; </code></pre> <p>tags after new line, is there a simple wa to remove them or I must search for them and "removechild" them?</p>