Problem with javascript onclick function string
<p>Hey all, i have been trying for a few minutes on this problem and i can not seem to figure out how to correct it. I tend to have the hardest time doing stuff like this when it involves more than one varable within the function.</p> <p>Here is the code:</p> <pre><code> var tempString = "thePrompt('Are you sure you wish to delete this?', 'theDel('" + IDnum + "', '" + theTitle + "', \'" + temperDay + "\', \'" + temperMonth + "\', \'" + temperYear + "\', \'" + DDiff + "\')"; html += "&lt;div id='theTable" + IDnum + "' class='fc-event fc-event-hori fc-corner-left fc-corner-right' style='position:absolute; margin-top: 15px; z-index:8;left:"+left+"px'&gt;&lt;div id='apDEL' style='position:relative;width:0px;height:0px;z-index:1000; top:-13px; left:2px; float:left;'&gt;&lt;img src='img/xCal.png' width='15' height='15' alt='' border='0' onclick=\"" + tempString + "\" /&gt;&lt;/div&gt;" + (ETC ETC...) </code></pre> <p>The error i keep getting is this:</p> <pre><code> Error: missing ) after argument list Line: 1, Column: 68 Source Code: thePrompt('Are you sure you wish to delete this posting?', 'theDel('105', '50 points for visiting us today!!!!', '13', '3', '2010', '2') </code></pre> <p>And its pointing to the '105'.</p> <p>As always, any help would be wonderful! :o)</p> <p>David</p> <p><B>EDIT/UPDATE</B></p> <p>Ok, so now i have moved some things around and i got it working (that is sending the values to the popup prompt box BUT for some reason it doesn't see my function after i hit the delete button! This is because the prompt is on the main page and the code i am working with is inside a iframe.</p> <pre><code>function theDel(theID, theTitle, day, month, year, DDiff) { var tempString = "delClientE(" + theID + ", '" + theTitle + "', " + day + ", " + month + ", " + year + ", " + DDiff + ")"; parent.thePrompt('Are you sure you wish to delete this event?', tempString); } </code></pre> <p>The delete button values now look like this:</p> <pre><code>delClientE(110, 'sadfsadfsdf', 14, 3, 2010, 2); jQuery.prompt.close(); </code></pre> <p>However, even putting parent.delClientE doesnt find the function either... How can i call it from within the iframe when the prompt box is outside of that?</p> <p>David</p>
<p>I think it's missing at the end of the statement .. your statement looks like this:</p> <pre><code>var tempString = "thePrompt('question', theDel(params)"; </code></pre> <p>.. where it should have one more closing ')' at the end. </p> <p>and one more thing you might want to look at is the fact that the arguments in theDel are wrapped in single quotes. </p> <pre><code>thePrompt('Are you sure you wish to delete this?', 'theDel('105', '50 points for visiting us today!!!!', '13', '3', '2010', '2')' ) </code></pre> <p>And that might be a problem since the params in thePrompt are also wrapped in single quotes so I would make the thePrompt have double quotes arround it's params so it would look something like this: </p> <pre><code>var tempString = "thePrompt(\"Are you sure you wish to delete this?\", \"theDel(\'" + IDnum + "\', \'" + theTitle + "\', \'" + temperDay + "\', \'" + temperMonth + "\', \'" + temperYear + "\', \'" + DDiff + "\')\")"; </code></pre>
<p>it's because of the quotes here <code>'theDel('" +</code> you should escape the inner single quotes. Edit. that is of course, in addition of the missing right paren issue already on the table. :)</p>
<p>Keeping track of escaping in nested contexts is really hard, and because when you get it wrong you've very often given yourself a script-injection security problem, it's much better to avoid creating HTML/JS by sticking strings together.</p> <p>Instead, use DOM methods to assign your event handler from JavaScript and say goodbye to all that irritating backslash and quoting stuff:</p> <pre><code>var img= document.createElement('img'); img.src= 'img/xCal.png'; img.width=img.height= 15; img.onclick= function() { if (confirm('Are you sure you wish to delete this?')) theDel(IDnum, theTitle, temperDay, temperMonth, temperYear, DDiff); }; div.appendChild(img); </code></pre>
<p>David, not sure if this has been answered to your satisfaction yet, but it might be easier to create a temporary variable for this:</p> <pre><code> var theDel = "theDel('" + IDnum + "', '" + theTitle + "', '" + temperDay + "', '" + temperMonth + "', '" + temperYear + "', '" + DDiff + "')"; var tempString = "thePrompt('Are you sure you wish to delete this?', \' + theDel + \')"; </code></pre>
<p>First of all, you'd be far better using <a href="http://lab.distilldesign.com/event-delegation/" rel="nofollow noreferrer">event delegation with the js library of your choice</a>.</p> <p>Failing that, a string interpolation function makes these sorts of things easier:</p> <pre><code>String.prototype.format = function(values) { return this.replace(/\{(.+?)\}/g, function(s, key) { return values[key]; }); } </code></pre> <p>So long things like this become:</p> <pre><code>var s = 'blah blah blah "{IDnum}" blah blah blah \'{foosball}\''.format({ IDnum: '1', foosball: 'xyz'}); </code></pre> <p>(If you don't like manipulating <code>String</code>'s prototype, you can put the function somewhere else.)</p>
<p>Ok, how about this?</p> <p><strong>iFrame source</strong></p> <pre><code>&lt;html&gt; &lt;head&gt; &lt;script type="text/javascript"&gt; function localDel(params){ if (window.parent &amp;&amp; typeof window.parent.thePrompt==='function') window.parent.thePrompt('Are you sure you wish to delete this event?', params); } &lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;p onclick="localDel([1,'some title', 14, 3, 2010, 2])"&gt;delete&lt;/p&gt; &lt;p onclick="localDel([2,'another title', 14, 3, 2010, 2])"&gt;delete&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; </code></pre> <p><strong>Parent source</strong></p> <pre><code>&lt;html&gt; &lt;head&gt; &lt;script type="text/javascript"&gt; function thePrompt(msg,params) { if(confirm(msg)) theDel.apply(this,params); } function theDel(id, title, tDay, tMonth, tYear, dDiff) { alert(id); // etc... } &lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;iframe src="iframe.html" /&gt; &lt;/body&gt; &lt;/html&gt; </code></pre>
<p>I finally got it!! YAY! :o)</p> <pre><code> function theDel(theID, theTitle, day, month, year, DDiff) { var tempString = "window.frames.theCal.delClientE(" + theID + ", '" + theTitle + "', " + day + ", " + month + ", " + year + ", " + DDiff + ")"; parent.thePrompt('Are you sure you wish to delete this event?', tempString); } </code></pre> <p>I needed the window.frames.theCal in order to call my function. theCal is my iframe id.</p> <p>David</p>