Javascript can't call an object inside a function
<p>Sorry, I am new to javascript. I am trying to call an object from inside a function to allow me to get a variable from a flash file at set intervals. For some reason the object is not working inside the timer function.</p> <pre><code>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt; &lt;html xmlns="http://www.w3.org/1999/xhtml"&gt; &lt;head&gt; &lt;title&gt;DIY Map&lt;/title&gt; &lt;style&gt; * { margin:0; padding:0; } &lt;/style&gt; &lt;/head&gt; &lt;body style="font-family:verdana;color:#999; background-image:url('bg.png'); background-repeat:no-repeat;"&gt; &lt;script type="text/javascript" src="js/JavaScriptFlashGateway.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="js/Exception.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="js/FlashTag.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="js/FlashSerializer.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="js/FlashProxy.js"&gt;&lt;/script&gt; &lt;script type="text/javascript"&gt; var uid = new Date().getTime(); var flashProxy = new FlashProxy(uid, 'js/JavaScriptFlashGateway.swf'); var tag = new FlashTag('world.swf?data_file=data.xml, 600, 325); tag.setFlashvars('lcId='+uid); tag.write(document); &lt;/script&gt; //flashProxy.call works here: &lt;p&gt;&lt;a href="javascript:flashProxy.call('zoomOut');"&gt;Zoom Out&lt;/a&gt; &lt;a href="javascript:flashProxy.call('refreshData','other_data.xml');"&gt;Get new data&lt;/a&gt; &lt;p&gt;&lt;a href="javascript:flashProxy.call('getZoom');"&gt;getZoom&lt;/a&gt; | &lt;a href="javascript:flashProxy.call('getCoords');"&gt;getCoords&lt;/a&gt;&lt;/p&gt; &lt;script type="text/javascript"&gt; // Start the refreshing process var seconds = 3; var zoom; var coords; //timer loop function checkmap() { //flashProxy doesn't work here flashProxy.call('getCoords'); flashProxy.call('getZoom'); alert (coords); alert (zoom); setTimeout('checkmap()',seconds * 1000); } checkmap(); //Returns results here: function gotCoords(n) { coords = n; } function gotZoom(n) { zoom = n; } &lt;/script&gt; </code></pre> <p>To clarify, I am trying to get the <code>flashProxy.call('****')</code> to work in the <code>checkmap()</code> function. Thanks in advance.</p>
<p>looks like a javascript scope problem, see this previous solution.</p> <p><a href="http://stackoverflow.com/questions/237350/javascript-how-to-solve-var-out-of-scope-within-settimeout-call">How to solve Var out of scope within setTimeout call</a></p> <p>Its worth reading up on <a href="http://www.digital-web.com/articles/scope_in_javascript/" rel="nofollow noreferrer">javascript scope</a> and save yourself a headache later on</p>
<p>Did you know you have an extra/unclosed script tag in your source? This would cause problems.</p> <pre><code>&lt;script type="text/javascript"&gt; // This is your opening tag &lt;script type="text/javascript"&gt; // Oops, this is parsed by the script engine var uid = new Date().getTime(); var flashProxy = new FlashProxy(uid, 'js/JavaScriptFlashGateway.swf'); var tag = new FlashTag('world.swf?data_file=data.xml, 600, 325); tag.setFlashvars('lcId='+uid); tag.write(document); &lt;/script&gt; </code></pre> <p>The above code would throw a syntax error in any javascript engine and halt further execution.</p> <p>Your source is also missing a <code>'</code> on the following line:</p> <pre><code>var tag = new FlashTag('world.swf?data_file=data.xml, 600, 325); </code></pre>
<p>I found the problem... it was that because there was no timer to start the inital flashproxy.call it was executing before the flash was loaded. I just replaced </p> <pre><code>checkmap(); </code></pre> <p>with another</p> <pre><code>setTimeout('checkmap()',seconds * 1000); </code></pre> <p>Thanks everyone anyway</p>