how to inject javascript code in url to insert iframe in existing page
<p>I am able to get the following JS to create IFRAME and add it to the page.</p> <p>The issue is if I create JS method on the page and ivoke it on a button click it works. But when I try to inject the same JS into the page url via setting the location.href it does not work the right way , rather it replaces the existing page with a new iframe.</p> <p>Here is my code:</p> <pre><code>location.href = "javascript:ifrm = document.createElement('IFRAME');ifrm.style.width = 60+'px';ifrm.style.height = 40+'px';document.body.appendChild(ifrm);"; </code></pre>
<p>Assuming the string is saved in the variable <code>mystring</code>:</p> <p><strong>Method 1</strong>:</p> <pre><code>eval( mystring.replace("javascript:", "") ); </code></pre> <p><strong>Method 2</strong> (if you want to keep the <code>"javascript:"</code>):</p> <pre><code>function clickLink(link) {     var cancelled = false;     if (document.createEvent) {         var event = document.createEvent("MouseEvents");         event.initMouseEvent("click", true, true, window,             0, 0, 0, 0, 0,             false, false, false, false,             0, null);         cancelled = !link.dispatchEvent(event);     }     else if (link.fireEvent) {         cancelled = !link.fireEvent("onclick");     }     if (!cancelled) {         window.location = link.href;     } } var link = document.createElement("a"); link.src = mystring; clickLink(link); </code></pre>
<p>What <a href="http://stackoverflow.com/questions/2653255/how-to-inject-javascript-code-in-url-to-insert-iframe-in-existing-page/2687519#2687519">Casey</a> said... Or you could put a "void 0;" at the end of the script...</p> <pre><code>location.href = "javascript:ifrm = document.createElement('IFRAME');ifrm.style.width = 60+'px';ifrm.style.height = 40+'px';document.body.appendChild(ifrm); void 0;"; </code></pre> <p>(I assume you're not actually doing this with location.href, but actually by typing/pasting into the url bar, or creating a bookmarklet... I used to get hit with this a lot when typing javascript into the url bar...)</p> <p>Anyway, the key thing to note is that if you set the location (by any of those three methods) to a javascript url, and the last statement returns something, the document body is set to that object. In your code, the last line is <code>document.body.appendChild(ifrm)</code> and <code>appendChild()</code> returns the ifrm object. In my suggested answer, the last statement is a void, so the document body isn't replaced. In Casey's suggestion, the function doesn't have a return statement, so it's a void function, and the document body is also not replaced.</p> <p>To get an idea of what's happening, try this instead:</p> <pre><code>location.href = "javascript:ifrm = document.createElement('IFRAME');ifrm.style.width = 60+'px';ifrm.style.height = 40+'px';document.body.appendChild(ifrm); 'Hello world';"; </code></pre> <p>or for some variability in the outcome</p> <pre><code>location.href = "javascript:ifrm = document.createElement('IFRAME');ifrm.style.width = 60+'px';ifrm.style.height = 40+'px';document.body.appendChild(ifrm); confirm('Pick one');"; </code></pre>
<p>You have to wrap it in a function...</p> <pre><code>location.href = "javascript:(function () {ifrm = document.createElement('IFRAME');ifrm.style.width = 60+'px';ifrm.style.height = 40+'px';document.body.appendChild(ifrm);})()"; </code></pre> <p>...although you can simply replace the location.href change with the actual code:</p> <pre><code>ifrm = document.createElement('IFRAME'); ifrm.style.width = 60+'px'; ifrm.style.height = 40+'px'; document.body.appendChild(ifrm); </code></pre>