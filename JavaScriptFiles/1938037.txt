Is this piece of Javascript inefficient?
<p>I was just wondering whether this snippet of Javascript is going to slow down my site:</p> <pre><code>$(function(){ var realLink = location.href; $( "#nav a" ).each( function( intIndex ){ String.prototype.startsWith = function(str){ return (this.indexOf(str) === 0); } var pageLink = $(this).attr("href"); if ( realLink.startsWith(pageLink) ) $(this).parent().addClass("active"); } ); }); </code></pre> <p>It only loops about 5-7 times, and I don't have very much Javascript looping experience.</p>
<p>Should be fine. If the <code>#nav</code> element doesn't contain thousands of links you should be OK.</p> <p>Install Firebug for Firefox and you can do a profile run. It will tell you how much time it spends in each function. My guess it will be in milliseconds for this case.</p>
<p>You could make that code perform a little better by changing it to:</p> <pre><code>String.prototype.startsWith = function(str){ return(this.indexOf(str) == 0); } $(function(){ var realLink = location.href; $('#nav a').each(function(intIndex){ var pageLink = $(this).attr("href"); if(realLink.startsWith(pageLink)) $(this).parent().addClass("active"); }); }); </code></pre> <p>It just breaks out the definition of <code>startsWith()</code> so you don't define it for each iteration of the loop.</p>
<p>There's nothing inherently wrong with this snippet, except that you're constantly creating and assigning a function to <code>String.prototype.startsWith</code> in a loop. That, of course, is an unnecessary work, and should at least be:</p> <pre><code>$(function(){ var realLink = location.href; String.prototype.startsWith = function(str){ return (this.indexOf(str) === 0); }; $( "#nav a" ).each( function( intIndex ){ var pageLink = $(this).attr("href"); if ( realLink.startsWith(pageLink) ) $(this).parent().addClass("active"); } ); }); </code></pre> <p>I also don't see a need for <code>intIndex</code> argument there. It's not used anywhere in a function.</p>
<p>Try using <a href="http://getfirebug.com/js.html" rel="nofollow noreferrer">Firebug's Profiling Feature</a> to measure the performance of your script.</p>
<p>if you use the ^= operator in Sizzle (well, jQuery in this case) it means "starts with this value" basically. try this:</p> <pre><code>$(function(){ $( '#nav a:not( [href^="' + startsWith + '"] )' ).addClass( 'active' ); }); </code></pre> <p>and change startsWith to a variable of your choice.</p>