Javascript: Force a reload from the server, how?
<p>I just found a snippet of code today as I need to refresh a page of mine so that a PHP script can run again to show new results from the DB every minute or so.</p> <pre><code>if (document.images) setTimeout('location.reload(true)',1000*60*15); // forces a reload from the server else setTimeout('location.href = location.href',1000*60*15); // just reloads the page </code></pre> <p>Whats the difference between the two? I mean do they not reload the page? How can the JS code force a reload from the server?</p> <p>Thanks all</p>
<p>i think the location.reload(true) will force the page reload from the server, the second example will reload the page but it will access the browser cache if it exists (and it probably does).</p> <p>here's a little more on the location.reload() method <a href="http://www.devguru.com/Technologies/Ecmascript/Quickref/reload.html" rel="nofollow noreferrer">http://www.devguru.com/Technologies/Ecmascript/Quickref/reload.html</a></p>
<p>The snippet will <em>try</em> to make a full page reload, if there are images on the page, otherwise it just make a <em>redirect</em> to the same page itself.</p> <p>Using <code>location.reload(true);</code>, the <code>true</code> argument causes the page to always be reloaded from the server.</p> <p>But that condition is always <code>true</code>, since <a href="https://developer.mozilla.org/en/DOM/document.images" rel="nofollow noreferrer"><code>document.images</code></a> is an HTMLCollection, and it will never evaluate to <code>false</code>, even if there are no images on the page, the only values that evaluate to <code>false</code> in a boolean expression are <code>null</code>, <code>undefined</code>, <code>0</code>, <code>NaN</code>, an empty string, and of course <code>false</code>.</p> <p>If you want to make that condition work, you should check the <code>length</code> property of <code>document.images</code>, the <code>length</code> property is numeric and that means that it will evaluate to <code>false</code> only when its value is <code>0</code>:</p> <pre><code>if (document.images.length) { setTimeout(function () { location.reload(true); // forces a reload from the server }, 1000*60*15); } else { setTimeout(function () { location.href = location.href; }, 1000*60*15); // just reloads the page } </code></pre> <p>Notice also that I'm now using function expressions instead of strings as the first argument of <code>setTimeout</code>, if strings are used the code will be evaluated at runtime (equivalent to a <code>eval</code> call) and that is not really considered as a good practice.</p>