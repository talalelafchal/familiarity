Help needed in using escape function in javascript
<p>I am using the follwing javascript function in my jsp file</p> <pre><code> &lt;script language="javascript"&gt; function openPopup() { var firstname = escape(&lt;%=addressBean.getFirstName()%&gt;); var lastname = escape(&lt;%=addressBean.getLastName()%&gt;); alert(firstname); alert(lastname); var mywindow = window.open('&lt;%= link("*", "BBFBUpdatePickupInfo")%&gt;&amp;ShoppingCartKey=&lt;%=cartKey%&gt;&amp;operation=&lt;%=operation%&gt;&amp;isEproAcc=&lt;%=isEpro%&gt;&amp;firstName="+firstname+"&amp;lastName="+lastname+"&amp;areaCode=&lt;%=addressBean.getPhoneAreaCode()%&gt;&amp;phoneNum=&lt;%=addressBean.getPhoneNumber()%&gt;','static','width=625,height=500,toolbar=0,location=0,directories=0,status=0,menuBar=0,scrollBars=yes,resizable=0'); mywindow.focus(); } &lt;/script&gt; </code></pre> <p>When addressBean.getFirstName() and addressBean.getLastName() returns names like "RED" as firstname and "WHITE" as lastname it is working fine. But when these two methods returns name like "VALENTINE" as firstname and "D'LOREY" as second name it is throwing below javascript error <br></p> <pre><code> Error: Unterminated string constant Code: 0 </code></pre> <p>Please help me to come out of this problem. Thanks in advance</p>
<p>HTML and Javascript are 2 escapes. I had this problem and nonscientifically just observed switch (too fast) from georss to KML just solved</p>
<p>Just create the url server-side since it is made of server-side variables. No need to do it with strings and escapes in javascript when you have everything at hand server-side.</p>
<p>(You haven't mentioned what your server-side language is; below I've assumed Java, so make adjustments if it's something else.)</p> <p>Think about what's actually getting sent to the browser when you do this:</p> <pre><code>var firstname = escape(&lt;%=addressBean.getFirstName()%&gt;); </code></pre> <p>When it goes out, it'll look like this:</p> <pre><code>var firstname = escape(JOE); </code></pre> <p>...which is almost certainly not what you want -- there are no quotes, for a start.</p> <p>So first we need quotes:</p> <pre><code>var firstname = escape("&lt;%=addressBean.getFirstName()%&gt;"); </code></pre> <p>But we also need to escape anything in the string that's going to be an issue in the resulting JavaScript string (on the server, when sending it to the browser). Off the cuff, that'll be at least quotes and backslashes, so:</p> <pre><code>var firstname = escape("&lt;%=addressBean.getFirstName().replace("\\", "\\\\").replace("\"", "\\\"")%&gt;"); </code></pre> <p>...but that's not thorough at all, you'll need to handle lots of other cases (newlines in the string, etc.). Really, you're going to want a utility function that does the work thoroughly, handling (for instance) unicode sequences, etc., if there's any possibility they'll be in the source data (which there very much is, if this involves people's names).</p> <p>And many have noted that instead of <code>escape</code>, you want <code>encodeURIComponent</code>.</p>
<p>You need to properly format your string so that it is compatible with JavaScript syntax in variables definition.</p> <p>This is what I do with PHP through the <code>json_encode()</code> function:</p> <pre><code>var firstname = &lt;?=json_encode(addressBean.getFirstName())?&gt;; </code></pre> <p>The JSON parser takes care of escaping the appropriate values and makes it JavaScript compatible.</p> <p>I'm not familiar with your language, but if it's ASP you can try out <a href="http://code.google.com/p/aspjson/" rel="nofollow noreferrer">aspjson</a>.</p>