Detecting state changes made to the BluetoothAdapter?
<p>I have an app with a button on it that I use to turn BT on and off. I have the following code in there;</p> <pre><code>public void buttonFlip(View view) { flipBT(); buttonText(view); } public void buttonText(View view) { Button buttonText = (Button) findViewById(R.id.button1); if (mBluetoothAdapter.isEnabled() || (mBluetoothAdapter.a)) { buttonText.setText(R.string.bluetooth_on); } else { buttonText.setText(R.string.bluetooth_off); } } private void flipBT() { if (mBluetoothAdapter.isEnabled()) { mBluetoothAdapter.disable(); } else { mBluetoothAdapter.enable(); } } </code></pre> <p>I'm calling button Flip, which flips the BT state, and then calls ButtonText, which should update the UI. However, the issue I'm having is, it takes a few seconds for BT to turn on - and during these seconds, the BT status is not enabled, making my button say Bluetooth off, even if it will be on in 2 seconds.</p> <p>I found the <code>STATE_CONNECTING</code> constant in the BluetoothAdapter android documentation, but... I simply don't know how to use it, being a newbie and all.</p> <p>So, I've got two questions:</p> <ol> <li>Is there a way to dynamically tie a UI element (such as a button or image) to a BT state, so that when the BT state changes, the button will change as well?</li> <li>Otherwise, I would want to press the button and get the correct state (I would like for it to say BT on, even if it's only connecting, since it will be on in 2 seconds). How do I do this?</li> </ol>
<p>You will want to register a <code>BroadcastReceiver</code> to listen for any changes in the state of the <code>BluetoothAdapter</code>:</p> <p>As a private instance variable in your <code>Activity</code> (or in a separate class file... whichever one you prefer):</p> <pre><code>private final BroadcastReceiver mReceiver = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { final String action = intent.getAction(); if (action.equals(BluetoothAdapter.ACTION_STATE_CHANGED)) { final int state = intent.getIntExtra(BluetoothAdapter.EXTRA_STATE, BluetoothAdapter.ERROR); switch (state) { case BluetoothAdapter.STATE_OFF: setButtonText("Bluetooth off"); break; case BluetoothAdapter.STATE_TURNING_OFF: setButtonText("Turning Bluetooth off..."); break; case BluetoothAdapter.STATE_ON: setButtonText("Bluetooth on"); break; case BluetoothAdapter.STATE_TURNING_ON: setButtonText("Turning Bluetooth on..."); break; } } } }; </code></pre> <p>Note that this assumes that your <code>Activity</code> implements a method <code>setButtonText(String text)</code> that will change the <code>Button</code>'s text accordingly.</p> <p>And then in your <code>Activity</code>, register and unregister the <code>BroadcastReceiver</code> as follows,</p> <pre><code>@Override public void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); /* ... */ // Register for broadcasts on BluetoothAdapter state change IntentFilter filter = new IntentFilter(BluetoothAdapter.ACTION_STATE_CHANGED); registerReceiver(mReceiver, filter); } @Override public void onDestroy() { super.onDestroy(); /* ... */ // Unregister broadcast listeners unregisterReceiver(mReceiver); } </code></pre>