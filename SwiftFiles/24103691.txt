How to set up game loop in Swift
<p>To set up a game loop in Objective-C I learnt that I should set up a CADisplayLink</p> <pre><code>updater = [CADisplayLink displayLinkWithTarget:self selector:@selector(gameLoop) ]; [updater setFrameInterval: 1]; [updater addToRunLoop: [NSRunLoop currentRunLoop] forMode: NSRunLoopCommonModes]; </code></pre> <p>How do I do this in Swift?</p> <p>I have tried to Google this but I cannot find any examples of this.</p>
<p>Pretty much just a direct translation from Objective-C to Swift with a few tweaks.</p> <pre><code>import QuartzCore var updater = CADisplayLink(target: self, selector: Selector("gameLoop")) updater.frameInterval = 1 updater.addToRunLoop(NSRunLoop.currentRunLoop(), forMode: NSRunLoopCommonModes) </code></pre>
<p>Here's my <code>GameLoop</code> class.</p> <pre><code>import UIKit class GameLoop : NSObject { var doSomething: () -&gt; ()! var displayLink : CADisplayLink! var frameInterval : Int! init(frameInterval: Int, doSomething: () -&gt; ()) { self.doSomething = doSomething self.frameInterval = frameInterval super.init() start() } // you could overwrite this too func handleTimer() { doSomething() } func start() { displayLink = CADisplayLink(target: self, selector: Selector("handleTimer")) displayLink.frameInterval = frameInterval displayLink.addToRunLoop(NSRunLoop.mainRunLoop(), forMode: NSRunLoopCommonModes) } func stop() { displayLink.paused = true displayLink.removeFromRunLoop(NSRunLoop.mainRunLoop(), forMode: NSDefaultRunLoopMode) displayLink = nil } } </code></pre>
<p>@Yar, @wegginho</p> <p>To stop the loop in Yar's GameLoop class, you need to add:</p> <pre><code>displayLink.paused = true </code></pre> <p>to the stop() function. Therefore, it should look like this:</p> <pre><code>func stop() { displayLink.paused = true displayLink.removeFromRunLoop(NSRunLoop.mainRunLoop(), forMode: NSDefaultRunLoopMode) displayLink = nil } </code></pre> <p>This updated stop function worked for me. Xcode 6.4.</p> <p>Hope this helps somebody as this question and Yar's answer has helped me!</p>
<p>Swift 3.x version of Brian Tracy's <a href="http://stackoverflow.com/a/24104044">answer</a>:</p> <pre><code>let updater = CADisplayLink(target: self, selector: #selector(self.gameLoop)) updater.preferredFramesPerSecond = 60 updater.add(to: RunLoop.current, forMode: RunLoopMode.commonModes) </code></pre> <p>Apart from the syntax changes of Swift 3, also note the iOS 10 API change from <code>frameInterval</code> (which still works, but produces a deprecated warning) to <code>preferredFramesPerSecond</code>.</p>