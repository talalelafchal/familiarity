Cannot Get JSON Data Out Of dataTask in Swift 3
First post, so be gentle. I am playing around with getting JSON data in Swift 3, Xcode 8.1. I am specifically getting my data from http://forecast.weather.gov/MapClick.php?lat=38.9782&lon=-76.4933&FcstType=json. My Code is as follows:  private func getWeatherData(url:URL) -> (currentObservation:Dictionary<String, AnyObject>, currentData:Dictionary<String, AnyObject>) { var currentObservation:Dictionary = [:] as Dictionary<String, AnyObject> var currentData:Dictionary = [:] as Dictionary<String, AnyObject> let task = URLSession.shared.dataTask(with: url) { (data, response, error) in if error != nil { print ("Error retrieving URLSession") } else { if let content = data { do { let JSONData = try JSONSerialization.jsonObject(with: content, options: JSONSerialization.ReadingOptions.mutableContainers) as AnyObject if let observation = JSONData["currentobservation"] as? Dictionary<String, AnyObject> { currentObservation = observation print("currentObservation inside of task: \(currentObservation)\n\n") } if let data = JSONData["data"] as? Dictionary<String, AnyObject> { currentData = data print("currentData inside of task: \(currentData)") } } catch { print("Error in trying JSONSerialization") } } } } task.resume() print("currentObservation outside of task: \(currentObservation) \n\n") print("currentData outside of task: \(currentData)") return (currentObservation , currentData) } The output I get is: currentObservation outside of task: [:] currentData outside of task: [:] currentObservation: [:] currentData: [:] currentObservation inside of task: ["state": MD, "name": Annapolis, United States Naval Academy, "longitude": -76.49, "elev": 3, "Relh": 79, "WindChill": NA, "Weather": Fair, "Altimeter": 1028.7, "latitude": 38.99, "Temp": 46, "SLP": 30.37, "id": KNAK, "timezone": EST, "Weatherimage": nsct.png, "Windd": 0, "Winds": 0, "Visibility": 10.00, "Gust": 0, "Dewp": 40, "Date": 7 Nov 20:54 pm EST] currentData inside of task: ["hazard": <__NSArrayM 0x60800005a520>( Frost Advisory, Hazardous Weather Outlook ), "weather": <__NSArrayM 0x60800005a490>( Clear then Areas Frost, Areas Frost then Sunny, Partly Cloudy then Slight Chance Showers, etc.(edited for brevity)] I am getting a JSON data response, but I can't seem to keep hold of the data. I am confused by several things. First, why are the print statements outside of the URLSession.shared.dataTask printed before those inside? Also, the print statements of "currentObservation" and "currentData" are called outside of the function, and they print before the ones inside of URLSession.shared.dataTask. Why is that? Lastly, and most importantly, why is the JSON data not making it out of the URLSession.shared.dataTask block? Any insight would be helpful. Thanks. Edit: This is now my current code based on Vinodh's response. currentObservation and currentData are still empty when I print them. class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() var currentObservation:Dictionary = [:] as Dictionary<String, AnyObject> var currentData:Dictionary = [:] as Dictionary<String, AnyObject> let serverURL = URL(string:"http://forecast.weather.gov/MapClick.php?lat=38.9782&lon=-76.4933&FcstType=json") getWeatherData(serverURL: serverURL!, completion: { serverResponse in if let observation = serverResponse["currentobservation"] as? Dictionary<String, AnyObject> { currentObservation = observation print("currentObservation inside of task: \(currentObservation)\n\n") } if let data = serverResponse["data"] as? Dictionary<String, AnyObject> { currentData = data print("currentData inside of task: \(currentData)\n\n") } }) print("currentObservation outside of task: \(currentObservation)\n\n") print("currentData outside of task: \(currentData)") } override func didReceiveMemoryWarning() { super.didReceiveMemoryWarning() // Dispose of any resources that can be recreated. } private func getWeatherData(serverURL:URL, completion:@escaping (AnyObject) ->()){ let task = URLSession.shared.dataTask(with: serverURL) { (data, response, error) in if error != nil { print ("Error retrieving URLSession") } else { if let content = data { do { let JSONData = try JSONSerialization.jsonObject(with: content, options: JSONSerialization.ReadingOptions.mutableContainers) as AnyObject completion(JSONData) } catch { print("Error in trying JSONSerialization") } } } } task.resume() } } And yes, I know I shouldn't be doing this all in the ViewController in violation of MVC, but I am just playing around trying to get it to work before adding the complexity of a data model and controller, as well as a UI. Thanks.
First, the code inside URLSession.shared.dataTask closure is not actually executed in the main thread, it will get called once you call task.resume() and it will run in background, thus all the print you do outside of it will get called first, since that task have not finish, thats why the print currentObservation inside of task inside will get called after Second, you dont use the task's response OUTSIDE of the code block, just imagine it like this : create task -> resume task -> network request.... -> finish code closure, you have to execute the code involve the response in the finish code closure, which is the part that holding the print currentObservation inside of task
Your closure are not good. Please change like below to get proper response . Service Call method :  private func getWeatherData(serverURL:URL ,completion:@escaping (AnyObject) ->()){ let task = URLSession.shared.dataTask(with: serverURL) { (data, response, error) in if error != nil { print ("Error retrieving URLSession") } else { if let content = data { do { let JSONData = try JSONSerialization.jsonObject(with: content, options: JSONSerialization.ReadingOptions.mutableContainers) as AnyObject completion(JSONData) } catch { print("Error in trying JSONSerialization") } } } } task.resume() } Response parsing: var currentObservation:Dictionary = [:] as Dictionary<String, AnyObject> var currentData:Dictionary = [:] as Dictionary<String, AnyObject> let serverURL = URL(string:"http://forecast.weather.gov/MapClick.php?lat=38.9782&lon=-76.4933&FcstType=json") getWeatherData(serverURL: serverURL!, completion: { serverResponse in if let observation = serverResponse["currentobservation"] as? Dictionary<String, AnyObject> { currentObservation = observation print("currentObservation inside of task: \(currentObservation)\n\n") } if let data = serverResponse["data"] as? Dictionary<String, AnyObject> { currentData = data print("currentData inside of task: \(currentData)") } })