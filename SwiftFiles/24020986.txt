Error when compiling a static library using Swift &quot;unknown option character `X' in: -Xlinker&quot;
<p>Seeing this error when adding a swift file for compilation into a static library. using XCode 6.0 (6A215l)</p> <p>Full libtool error: <code> Libtool DerivedData/SwiftTest/Build/Products/Debug-iphonesimulator/libstatic.a normal i386 cd /Users/al/dev/ios/SwiftTest2 export IPHONEOS_DEPLOYMENT_TARGET=8.0 export PATH="/Applications/Xcode6-Beta.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/usr/bin:/Applications/Xcode6-Beta.app/Contents/Developer/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin" /Applications/Xcode6-Beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/libtool -static -arch_only i386 -syslibroot /Applications/Xcode6-Beta.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator8.0.sdk -L/Users/al/dev/ios/SwiftTest2/DerivedData/SwiftTest/Build/Products/Debug-iphonesimulator -filelist /Users/al/dev/ios/SwiftTest2/DerivedData/SwiftTest/Build/Intermediates/SwiftTest.build/Debug-iphonesimulator/static.build/Objects-normal/i386/static.LinkFileList -ObjC -L/Applications/Xcode6-Beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/iphonesimulator -Xlinker -rpath -Xlinker /Applications/Xcode6-Beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/iphonesimulator -Xlinker -force_load -Xlinker /Applications/Xcode6-Beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/arc/libarclite_iphonesimulator.a -Xlinker -sectalign -Xlinker __SWIFT -Xlinker __ast -Xlinker 4 -Xlinker -sectcreate -Xlinker __SWIFT -Xlinker __ast -Xlinker /Users/al/dev/ios/SwiftTest2/DerivedData/SwiftTest/Build/Intermediates/SwiftTest.build/Debug-iphonesimulator/static.build/Objects-normal/i386/static.swiftmodule -o /Users/al/dev/ios/SwiftTest2/DerivedData/SwiftTest/Build/Products/Debug-iphonesimulator/libstatic.a </code></p> <p>I've create a sample project here, the error happens in a completly fresh project: <a href="https://github.com/amleszk/SwiftTest/tree/cd94ca21d817fed336b1a3bfc774a13608e0d1ca">https://github.com/amleszk/SwiftTest/tree/cd94ca21d817fed336b1a3bfc774a13608e0d1ca</a></p> <p>To reproduce checkout the project and build the SwiftTest target, which has a dependency on the static library. Any help appreciated</p>
<p><strong>Update:</strong> It seems like the official release of Xcode 6 still has that same issue.</p> <p>From the xcode 6 beta 2 release notes:</p> <blockquote> <p>It is not possible to build static libraries which contain Swift code in this release</p> </blockquote>
<p>I have found the solution. This is hook, but it works. You should do this as root.</p> <ol> <li><p>Go to default toolchain bin directory</p> <p><code>cd $(xcode-select -p)/Toolchains/XcodeDefault.xctoolchain/usr/bin</code></p></li> <li><p>Rename current libtool to old_libtool</p> <p><code>mv libtool old_libtool</code></p></li> <li><p>Create new libtool</p> <p><code>touch libtool &amp;&amp; chmod +x libtool</code></p></li> <li><p>Insert current script as content of new libtool</p> <pre><code>#!/usr/bin/python import os import subprocess import sys args=[] for arg in sys.argv[1:]: if arg != '-Xlinker' and arg != '-add_ast_path' and not arg.endswith('swiftmodule'): args.append(arg) args.insert(0, os.path.join(os.path.dirname(os.path.realpath(__file__)), 'old_libtool')) subprocess.check_call(args) </code></pre></li> <li><p>Compile.</p></li> </ol>