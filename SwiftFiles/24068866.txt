Perform POST request in Swift
<p>I am trying to do something like this:</p> <pre><code>NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@"http://google.com"]]; request.HTTPMethod = @"POST"; NSString *stringData = @"some data"; NSData *requestBodyData = [stringData dataUsingEncoding:NSUTF8StringEncoding]; request.HTTPBody = requestBodyData; NSURLConnection *conn = [[NSURLConnection alloc] initWithRequest:request delegate:self]; </code></pre> <p>This is what I have so far:</p> <pre><code>var url = NSURL(string: "some url") var request = NSMutableURLRequest(URL: url) request.HTTPMethod = "POST" var dataString = "some data" var requestBodyData: NSData = dataString.stringByAddingPercentEscapesUsingEncoding(NSUTF8StringEncoding) as NSData request.HTTPBody = requestBodyData var connection = NSURLConnection(request: request, delegate: self, startImmediately: false) println("sending request...") connection.start() </code></pre> <p>However, the var requestBodyData: line throws the first stone with "Cannot convert the expression's type NSData to type NSData"</p> <p>Anyone care to weigh in?</p>
<p><code>stringByAddingPercentEscapesUsingEncoding</code> returns a string instead of an NSData object. According to <a href="http://stackoverflow.com/questions/24039868/creating-nsdata-from-nsstring-in-swift">this</a> answer, you need to use this to convert to an NSData instance:</p> <pre><code>let data = (anySwiftString as NSString).dataUsingEncoding(NSUTF8StringEncoding) </code></pre>
<p>Using <strong><a href="https://github.com/Alamofire/Alamofire" rel="nofollow">Alamofire</a></strong> to send HTTP POST request</p> <pre><code>let request = NSMutableURLRequest(URL: NSURL(string: "https://www.google.com")!) request.HTTPMethod = "POST" let body = "email=\(email)&amp;access_token=\(token)" request.HTTPBody = body.dataUsingEncoding(NSUTF8StringEncoding) Alamofire.request(request).responseJSON { response in NSLog("response.request: \(response.request)") // original URL request NSLog("esponse.response: \(response.response)") // URL response switch response.result { case .Success: NSLog("Validation Successful") case .Failure(let error): // Logout NSLog("\(error), \(String(data: response.data!, encoding: NSUTF8StringEncoding))") return } // Save sip account information to NSUserdefaults if let json = response.result.value as? [String: AnyObject]{ // Do your stuff } } </code></pre>