OSX status menu not working in Swift
<p>I tried to add a simple status menu to the status bar with swift but it will not be shown.</p> <p>with objective-c this worked:</p> <hr> <p>AppDelegate.h</p> <pre><code>@interface AppDelegate : NSObject &lt;NSApplicationDelegate&gt; { IBOutlet NSMenu *statusMenu; NSStatusItem * statusItem; } @end </code></pre> <p>AppDelegate.m</p> <pre><code>@implementation AppDelegate - (void)applicationDidFinishLaunching:(NSNotification *)aNotification { statusItem = [[NSStatusBar systemStatusBar] statusItemWithLength:NSVariableStatusItemLength]; [statusItem setMenu:statusMenu]; [statusItem setTitle:@"Status Menu"]; [statusItem setHighlightMode:YES]; } @end </code></pre> <hr> <p>But if i try to do basically the same thing in swift it doesn't do anything. </p> <pre><code>class AppDelegate: NSObject, NSApplicationDelegate { @IBOutlet var statusMenu: NSMenu; func applicationDidFinishLaunching(aNotification: NSNotification?) { let bar = NSStatusBar.systemStatusBar() let statusItem = bar.statusItemWithLength(CGFloat(NSVariableStatusItemLength)) statusItem.title = "Status Menu" statusItem.menu = statusMenu statusItem.highlightMode = true } } </code></pre> <p>There's no error, it just doesn't do anything. the function <code>applicationDidFinishLaunching</code> is called since a println() inside it creates output.</p> <p>Does anyone have an idea what I'm doing wrong here?</p>
<p>The problem here is that <code>statusItem</code> is going out of scope after <code>applicationDidFinishLaunching</code> finishes execution which in turn releases the object. This is not the case in your Objective-C code because the <code>statusItem</code> variable is declared at class level.</p> <p>This should make your Swift code work:</p> <pre><code>class AppDelegate: NSObject, NSApplicationDelegate { @IBOutlet var statusMenu: NSMenu; var statusItem: NSStatusItem?; func applicationDidFinishLaunching(aNotification: NSNotification?) { let bar = NSStatusBar.systemStatusBar() statusItem = bar.statusItemWithLength(CGFloat(NSVariableStatusItemLength)) statusItem!.title = "Status Menu" statusItem!.menu = statusMenu statusItem!.highlightMode = true } } </code></pre>