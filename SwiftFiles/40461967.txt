Swipe to Delete being tapped twice
How do I stop the swipe to delete function from being tapped twice on my table view? Its causing crashes by trying to delete data twice, or access data already deleted. Example of the swipe to delete functionality I'm talking about: http://media.tumblr.com/25eb2fcf7aa2cd84f5cb27c54ca1ad5b/tumblr_inline_muotqqEYrY1qzumo9.jpg All code relating to the swipe to delete functionality: http://pastebin.com/5VEbPvEC This is the code to delete: //HTTP GET request to delete from server //Then in: DispatchQueue.main.async { ... self.leaderboardData.remove(at: indexPath.row) self.tableView.deleteRows(at: [indexPath], with: .fade) } EDIT: I tried disabling user interaction as well: func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) { let cell = tableView.cellForRow(at: indexPath) cell?.isUserInteractionEnabled = false The delete event was still triggered twice. EDIT 2: When I tap twice I either get this crash: libswiftFoundation.dylib`static Foundation.IndexPath._unconditionallyBridgeFromObjectiveC (Swift.Optional<__ObjC.NSIndexPath>) -> Foundation.IndexPath: 0x100c72914 <+0>: stp x20, x19, [sp, #-32]! 0x100c72918 <+4>: stp x29, x30, [sp, #16] 0x100c7291c <+8>: add x29, sp, #16 ; =16 0x100c72920 <+12>: mov x19, x0 0x100c72924 <+16>: cbz x19, 0x100c7294c ; <+56> 0x100c72928 <+20>: mov x0, x19 0x100c7292c <+24>: bl 0x100c9ae14 ; function signature specialization <Arg[0] = Owned To Guaranteed, Arg[1] = Dead> of Foundation.IndexPath.init (nsIndexPath : __ObjC.NSIndexPath) -> Foundation.IndexPath 0x100c72930 <+28>: mov x20, x0 0x100c72934 <+32>: mov x0, x19 0x100c72938 <+36>: bl 0x100cdc2e4 ; symbol stub for: objc_release 0x100c7293c <+40>: mov x0, x20 0x100c72940 <+44>: ldp x29, x30, [sp, #16] 0x100c72944 <+48>: ldp x20, x19, [sp], #32 0x100c72948 <+52>: ret -> 0x100c7294c <+56>: brk #0x1 Or I see a few of these: /api/leaderboards/delete/132 returned 500. The 500 indicates that it failed to delete the record because there was no record. This only occurs when I mash the delete button that appears. EDIT 3: I've changed my code a little, now mashing the delete button is not causing a crash, but whenever I delete the last row, I get a crash. Code: http://pastebin.com/57hMZQiJ A breakpoint is triggered at line: self.tableView.deleteRows(at: [indexPath], with: .fade) *** Assertion failure in -[UITableView _endCellAnimationsWithContext:], /BuildRoot/Library/Caches/com.apple.xbs/Sources/UIKit_Sim/UIKit-3600.5.2/UITableView.m:1610 Thanks.
Solved. So I had a few problems. I was trying to disable user interaction in didSelectRowAt. Instead of in func tableView(_ tableView: UITableView, commit editingStyle: UITableViewCellEditingStyle, forRowAt indexPath: IndexPath) which I do now. I think this solved the mashing on "Delete" button problem. Then the problems where I was getting a crash only when deleting the last row came from an incorrect return value of numRowsInSection. When the data array is empty I load a placeholder cell, giving the user some info about what to do. This making the app attempt to read an index that no longer exists. So I solved it by doing this: self.leaderboardData.remove(at: indexPath.row) if self.tableView.numberOfRows(inSection: indexPath.section) == 1 { self.tableView.reloadData() } else { self.tableView.deleteRows(at: [indexPath], with: .fade) } When it gets to one, I reload the table data because my numOfRowsInSection looks like this: func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int { var count = 0 if leaderboardData.count < 1 { count = 1 } else { count = leaderboardData.count } return count }