Some cells bottom are being cut off using UICollectionViewCell and dequeueReusableCell
I spent almost an entire day trying to figure out what is going on with my UICollectionView. I’m trying to implement a feed news like facebook, but for some obscure reason I’m having some weird behaviors reusing cells. I’ve read Apple’s documentation related to that tons of time and tried diverses fixes. I'm using Firebase to pull out the data, but when the user scrolls down a function asks for more data and merges with the posts array, and calls collectionView.reloadData()... ` override func scrollViewDidEndDragging(_ scrollView: UIScrollView, willDecelerate decelerate: Bool) { // UITableView only moves in one direction, y axis let currentContentOffset = scrollView.contentOffset.y let maximumContentOffset = scrollView.contentSize.height - scrollView.frame.size.height // Set the minimum distance from bottom to load more posts if maximumContentOffset - currentContentOffset <= 1000.0 { self.updateNewRecords(withOffset: self.currentOffset, findOffsetByItemInArray: false) } } A second function override func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -> UICollectionViewCell { let post = posts[indexPath.item] let feedCell: FeedCell feedCell = collectionView.dequeueReusableCell(withReuseIdentifier: FeedCellType.withImage, for: indexPath) as! FeedCell feedCell.post = post feedCell.delegate = self return feedCell } Because the content is dynamic I need to calculate the estimated heigh... func collectionView(_ collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, sizeForItemAt indexPath: IndexPath) -> CGSize { let postItem = posts[indexPath.item] if let statusText = postItem.content { var knownVerticalSize: CGFloat if postItem.featuredImageURL != nil { knownVerticalSize = 311 } else { knownVerticalSize = 212 } let estimatedTextStringSize = NSString(string: statusText).boundingRect(with: CGSize(width: view.frame.width - 16, height: 1000), options: NSStringDrawingOptions.usesFontLeading.union(NSStringDrawingOptions.usesLineFragmentOrigin), attributes: [NSFontAttributeName: UIFont.systemFont(ofSize: 14)], context: nil) return CGSize(width: view.frame.width, height: estimatedTextStringSize.height + knownVerticalSize + 60) } return CGSize(width: view.frame.width, height: 220) } My cell is created programmatically, so in its init I call a function to create the elements and set the constraints. The only changeable height is for the content which takes the rest of the available height for the view. I don't really think the problem is on the constraints. Debugging I can see that the elements are there, even the height is reserved but for some reason it just doesn't completly display. I'm calling prepareForReuse to clean up labels, image and textview. Though I have a even weirder error with image... Sometimes when 3 cells are being showed on the screen, when the image of the 3rd one loads it replaces the image of the first one. I have no clue why. I'm really stressed out. I rarely ask questions because searching always can find a solution. I found many problems related to mine, and tested their solutions and nothing seems to work. I will really appreciate any help. Check the screens illustrating the problem: After 2 posts correctly showed, the bottom of the 3rd one is cut off The last post 6th: all its bottom is cut off EDIT I believe I just found a correlation between the problem and init being called. I have 6 posts and init is called 4 times. The problem with the layout is in 2 posts only... I'm kinda confused yet. At first, I thought that a reusable cell would have its init called just once... But I can't figure why the contraints would have to be set every time. I'm done for today. Tomorrow I'm going to look closer at this.