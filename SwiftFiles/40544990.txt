Room persistent coming false. How can i create MUC group permanently and join it?
I have seen so many links and followed this way for creating MUC chat room in swift using xmpp-messenger-ios . But the app is running with a crash.. giving error unexpectedly found nil while unwrapping an Optional value. Creating group class class AddGroupTableViewController: UITableViewController, XMPPRoomDelegate{ override func viewDidLoad() { super.viewDidLoad() } override func viewWillAppear(animated: Bool) { super.viewWillAppear(animated) if OneChat.sharedInstance.isConnected() { navigationItem.title = "New Group" } } @IBAction func CreateGroupPressed(sender: AnyObject) { let roomJID:XMPPJID = XMPPJID.jidWithString("pradip@conference.obp.in") let roomData: XMPPRoomCoreDataStorage = XMPPRoomCoreDataStorage.sharedInstance() //let roomMemoryStorage = XMPPRoomMemoryStorage() let xmppRoom = XMPPRoom(roomStorage: roomData, jid: roomJID, dispatchQueue: dispatch_get_main_queue()) xmppRoom.activate(OneChat.sharedInstance.xmppStream) xmppRoom.addDelegate(self, delegateQueue: dispatch_get_main_queue()) // print(OneChat.sharedInstance.xmppStream!.myJID.bare()) // print(OneChat.sharedInstance.xmppStream!.myJID.user) xmppRoom.joinRoomUsingNickname(OneChat.sharedInstance.xmppStream!.myJID.user, history: nil) } func xmppRoomDidCreate(sender: XMPPRoom!) { print("room created ") print(sender) } func xmppRoomDidJoin(sender: XMPPRoom!) { print("room joined") sender.fetchConfigurationForm() sender.configureRoomUsingOptions(nil) sender.fetchMembersList(); sender.sendMessageWithBody("group accept karo bhaiya"); let strInvitedUserName = XMPPJID.jidWithString("226@obp.in") sender.editRoomPrivileges([XMPPRoom.itemWithAffiliation("member", jid: strInvitedUserName)]) sender.inviteUser(strInvitedUserName, withMessage: "greetings") } func xmppRoom(sender: XMPPRoom!, didFetchConfigurationForm configForm: DDXMLElement!) { let newConfig = configForm as DDXMLElement let fields = newConfig.elementsForName("field") for field in fields { let ver = field.attributeStringValueForName("var") // Make Room Persistent if (ver == "muc#roomconfig_persistentroom") { field.removeChildAtIndex(0) field.addChild(DDXMLElement(name: "value", stringValue: "50")) } } sender.configureRoomUsingOptions(newConfig) print(newConfig) } } But after that app is crashing here extension OneMessage: XMPPStreamDelegate { public func xmppStream(sender: XMPPStream, didSendMessage message: XMPPMessage) { if let completion = OneMessage.sharedInstance.didSendMessageCompletionBlock { completion(stream: sender, message: message) } //OneMessage.sharedInstance.didSendMessageCompletionBlock!(stream: sender, message: message) } public func xmppStream(sender: XMPPStream, didReceiveMessage message: XMPPMessage) { var xmppRosterStorage = XMPPRosterCoreDataStorage() let user = OneChat.sharedInstance.xmppRosterStorage.userForJID(message.from(), xmppStream: OneChat.sharedInstance.xmppStream, managedObjectContext: OneRoster.sharedInstance.managedObjectContext_roster()) print(" user value \(user)") //app is crashing coming nil value // guard let user = OneChat.sharedInstance.xmppRosterStorage.userForJID(message.from(), xmppStream: OneChat.sharedInstance.xmppStream, managedObjectContext: OneRoster.sharedInstance.managedObjectContext_roster()) // else { fatalError("user is nil") } // // guard let userJIDStr = user.jidStr // else { fatalError("jidStr is nil") } // if !OneChats.knownUserForJid(jidStr: user.jidStr) { OneChats.addUserToChatList(jidStr: user.jidStr) } if message.isChatMessageWithBody() { OneMessage.sharedInstance.delegate?.oneStream(sender, didReceiveMessage: message, from: user) } else { //was composing if let _ = message.elementForName("composing") { OneMessage.sharedInstance.delegate?.oneStream(sender, userIsComposing: user) } } } } my group is creating until i killed the app. after that group is automatically deleting . I already am sending the roompersistent as (true value 1). but i why its creating group with persistence false.. .