From UnsafePointer&lt;UnsafePointer&lt;CFloat&gt;&gt; to an array of floats in Swift?
<p>I'm trying to access <code>AVAudioPCMBuffer.floatChannelData</code> using Swift but it is of type <code>UnsafePointer&lt;UnsafePointer&lt;CFloat&gt;&gt;</code> (in Objective-C, <code>@property(nonatomic, readonly) float *const *floatChannelData</code>) and any attempt I make to access it results in execution failed.</p> <p>Sample code to set-up a quick AVAudioPCMBuffer in a Swift Playground is included in a previous question:</p> <p><a href="http://stackoverflow.com/questions/24088470/getting-avaudiopcmbuffer-working-avaudiofile-mm-error-code-50">Getting AVAudioPCMBuffer working (AVAudioFile.mm error code -50)</a> </p>
<p>Does this work?</p> <pre><code>let channels = UnsafeBufferPointer(start: myAudioBuffer.floatChannelData, count: Int(myAudioBuffer.format.channelCount)) let floats = UnsafeBufferPointer(start: channels[0], count: Int(myAudioBuffer.frameLength)) </code></pre>
<p>What you can also do is in order to access <code>AVAudioBuffer</code>:</p> <pre><code>for var i = 0; i &lt; Int(audioBuffer.frameLength); i+=Int(audioMixerNode.outputFormatForBus(0).channelCount) { self.audioBuffer.floatChannelData.memory[i] = 0.0f; // or whatever } </code></pre> <p>You can find more about that in the <a href="https://developer.apple.com/library/prerelease/ios/documentation/AVFoundation/Reference/AVAudioPCMBuffer_Class/index.html#//apple_ref/occ/cl/AVAudioPCMBuffer" rel="nofollow">Apple pre-release documentation:</a></p> <blockquote> <p>The <code>floatChannelData</code> property returns pointers to the buffer’s audio samples, if the buffer’s format is 32-bit float. It returns <code>nil</code> if it is another format. The returned pointer is to <code>format.channelCount</code> pointers to float. Each of these pointers is to <code>frameLength</code> valid samples, which are spaced by <code>stride</code> samples.</p> </blockquote>