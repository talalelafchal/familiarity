Counting characters from text in XML file using Perl's split function
<p>I have a XML file that looks like this:</p> <pre><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt; &lt;ISOSpaceTaskv1.15&gt; &lt;TEXT&gt;&lt;![CDATA[ WHERE TO GO In this sprawling city, the parts of Madrid of greatest interest to foreign visitors are remarkably compact. Viejo Madrid, the city of the Hapsburgs, covers a small area that extends east from the pitiful Río Manzanares and magnificent Palacio Real to Puerta del Sol. Almost all of it can be covered in a day or two, including a lengthy visit to the Royal Palace. The Madrid of the Bourbon dynasty, home to Spain’s great art museums, is the next area worthy of exploring (for art lovers, though, it may very well be the first). Spain’s Golden Triangle of Art is concentrated on the elegant but busy Paseo del Prado, between Puerta del Sol and Retiro Park. Those with more time in Madrid, either before or after side trips to the great towns of Castile, might explore the barrio of Salamanca, take in a bullfight, or visit one or more of the smaller, more personal museums, only a ride from the Puerta del Sol. ]]&gt;&lt;/TEXT&gt; &lt;TAGS&gt; &lt;PLACE id="pl0" start="66" end="72" text="Madrid" type="" dimensionality="AREA" form="NAM" domain="" continent="" state="" country="" ctv="" gazref="" latLong="" elevation="" mod="" dcl="FALSE" countable="TRUE" gquant="" scopes="" comment="" /&gt; &lt;PLACE id="pl1" start="47" end="51" text="city" type="" dimensionality="AREA" form="NOM" domain="" continent="" state="" country="" ctv="" gazref="" latLong="" elevation="" mod="" dcl="FALSE" countable="TRUE" gquant="" scopes="" comment="" /&gt; &lt;/TAGS&gt; &lt;/ISOSpaceTaskv1.15&gt; </code></pre> <p>The <code>start</code> and <code>end</code> attributes in the <code>&lt;PLACE&gt;</code> tags indicate the character in which the text in the <code>text</code> attribute from starts and ends within the text contained in the <code>&lt;TEXT&gt;</code> tag. For example, <em>Madrid</em> starts in the 66th character and ends in the 72th character of the text in <code>&lt;TEXT&gt;</code>.</p> <p>I want to know which are the <code>start</code> and <code>end</code> values for every word in the text contained in <code>&lt;TEXT&gt;</code>. For this purpose I use the next Perl code:</p> <pre><code>for my $tag ($doc-&gt;findnodes('ISOSpaceTaskv1.15/TEXT')){ my $text = $tag-&gt;textContent; my @Text_sp = split(undef, $text); my $count = 1; foreach my $character (@Text_sp){ print "$count\n"; $count = $count + 1; .... } } </code></pre> <p>The problem is I get <code>start</code> and <code>end</code> values that different from the ones in the xml file. For example for the first PLACE tag I get values 34 and 39. I suspect the split does not work as expected but I really do not know which the exact problem is.</p>
<p>You can use regex search and <code>pos</code> function:</p> <pre><code>while( $text=~/\b([^\s,.;:!?]+)/g ) { my $end = pos($text); my $start = $end-length($1); print "$start-$end $1\n"; } </code></pre> <p>First output lines looks like this:</p> <pre><code>9-14 WHERE 15-17 TO 18-20 GO 29-31 In 32-36 this 37-46 sprawling 47-51 city 53-56 the 57-62 parts 63-65 of 66-72 Madrid 73-75 of </code></pre> <p>Seems <strong>start</strong> and <strong>end</strong> are correct, probably you will need to tune the regex to meet what you want to be "word boundry".</p>
<p>Using a regex to capture words:</p> <pre><code>use strict; use warnings; use utf8; use XML::LibXML; binmode(STDOUT, ":unix:utf8"); my $xml = XML::LibXML-&gt;load_xml(string =&gt; do { binmode DATA, ':utf8'; local $/; &lt;DATA&gt; }); for my $tag ($xml-&gt;findnodes('ISOSpaceTaskv1.15/TEXT')){ my $text = $tag-&gt;textContent; while ($text =~ m/([^\s,().]+)/g) { my $word = $1; my $start = $-[0]; my $end = $+[0] - 1; print "$start-$end &lt;$word&gt;\n"; } } __DATA__ &lt;?xml version="1.0" encoding="UTF-8" ?&gt; &lt;ISOSpaceTaskv1.15&gt; &lt;TEXT&gt;&lt;![CDATA[ WHERE TO GO In this sprawling city, the parts of Madrid of greatest interest to foreign visitors are remarkably compact. Viejo Madrid, the city of the Hapsburgs, covers a small area that extends east from the pitiful Río Manzanares and magnificent Palacio Real to Puerta del Sol. Almost all of it can be covered in a day or two, including a lengthy visit to the Royal Palace. The Madrid of the Bourbon dynasty, home to Spain’s great art museums, is the next area worthy of exploring (for art lovers, though, it may very well be the first). Spain’s Golden Triangle of Art is concentrated on the elegant but busy Paseo del Prado, between Puerta del Sol and Retiro Park. Those with more time in Madrid, either before or after side trips to the great towns of Castile, might explore the barrio of Salamanca, take in a bullfight, or visit one or more of the smaller, more personal museums, only a ride from the Puerta del Sol. ]]&gt;&lt;/TEXT&gt; &lt;TAGS&gt; &lt;PLACE id="pl0" start="66" end="72" text="Madrid" type="" dimensionality="AREA" form="NAM" domain="" continent="" state="" country="" ctv="" gazref="" latLong="" elevation="" mod="" dcl="FALSE" countable="TRUE" gquant="" scopes="" comment="" /&gt; &lt;PLACE id="pl1" start="47" end="51" text="city" type="" dimensionality="AREA" form="NOM" domain="" continent="" state="" country="" ctv="" gazref="" latLong="" elevation="" mod="" dcl="FALSE" countable="TRUE" gquant="" scopes="" comment="" /&gt; &lt;/TAGS&gt; &lt;/ISOSpaceTaskv1.15&gt; </code></pre> <p>Outputs:</p> <pre><code>9-13 &lt;WHERE&gt; 15-16 &lt;TO&gt; 18-19 &lt;GO&gt; 29-30 &lt;In&gt; 32-35 &lt;this&gt; 37-45 &lt;sprawling&gt; 47-50 &lt;city&gt; 53-55 &lt;the&gt; 57-61 &lt;parts&gt; 63-64 &lt;of&gt; 66-71 &lt;Madrid&gt; 73-74 &lt;of&gt; 76-83 &lt;greatest&gt; 93-100 &lt;interest&gt; 102-103 &lt;to&gt; 105-111 &lt;foreign&gt; 113-120 &lt;visitors&gt; 122-124 &lt;are&gt; 126-135 &lt;remarkably&gt; 137-143 &lt;compact&gt; 146-150 &lt;Viejo&gt; 152-157 &lt;Madrid&gt; 160-162 &lt;the&gt; 172-175 &lt;city&gt; 177-178 &lt;of&gt; 180-182 &lt;the&gt; 184-192 &lt;Hapsburgs&gt; 195-200 &lt;covers&gt; 202-202 &lt;a&gt; 204-208 &lt;small&gt; 210-213 &lt;area&gt; 215-218 &lt;that&gt; 220-226 &lt;extends&gt; 228-231 &lt;east&gt; 233-236 &lt;from&gt; 238-240 &lt;the&gt; 250-256 &lt;pitiful&gt; 258-260 &lt;Río&gt; 262-271 &lt;Manzanares&gt; 273-275 &lt;and&gt; 277-287 &lt;magnificent&gt; 289-295 &lt;Palacio&gt; 297-300 &lt;Real&gt; 302-303 &lt;to&gt; 305-310 &lt;Puerta&gt; 312-314 &lt;del&gt; 316-318 &lt;Sol&gt; 329-334 &lt;Almost&gt; 336-338 &lt;all&gt; 340-341 &lt;of&gt; 343-344 &lt;it&gt; 346-348 &lt;can&gt; 350-351 &lt;be&gt; 353-359 &lt;covered&gt; 361-362 &lt;in&gt; 364-364 &lt;a&gt; 366-368 &lt;day&gt; 370-371 &lt;or&gt; 373-375 &lt;two&gt; 378-386 &lt;including&gt; 388-388 &lt;a&gt; 390-396 &lt;lengthy&gt; 406-410 &lt;visit&gt; 412-413 &lt;to&gt; 415-417 &lt;the&gt; 419-423 &lt;Royal&gt; 425-430 &lt;Palace&gt; 433-435 &lt;The&gt; 437-442 &lt;Madrid&gt; 444-445 &lt;of&gt; 447-449 &lt;the&gt; 451-457 &lt;Bourbon&gt; 459-465 &lt;dynasty&gt; 468-471 &lt;home&gt; 473-474 &lt;to&gt; 484-490 &lt;Spain’s&gt; 492-496 &lt;great&gt; 498-500 &lt;art&gt; 502-508 &lt;museums&gt; 511-512 &lt;is&gt; 514-516 &lt;the&gt; 518-521 &lt;next&gt; 523-526 &lt;area&gt; 528-533 &lt;worthy&gt; 535-536 &lt;of&gt; 538-546 &lt;exploring&gt; 549-551 &lt;for&gt; 561-563 &lt;art&gt; 565-570 &lt;lovers&gt; 573-578 &lt;though&gt; 581-582 &lt;it&gt; 584-586 &lt;may&gt; 588-591 &lt;very&gt; 593-596 &lt;well&gt; 598-599 &lt;be&gt; 601-603 &lt;the&gt; 605-609 &lt;first&gt; 613-619 &lt;Spain’s&gt; 621-626 &lt;Golden&gt; 636-643 &lt;Triangle&gt; 645-646 &lt;of&gt; 648-650 &lt;Art&gt; 652-653 &lt;is&gt; 655-666 &lt;concentrated&gt; 668-669 &lt;on&gt; 671-673 &lt;the&gt; 675-681 &lt;elegant&gt; 683-685 &lt;but&gt; 687-690 &lt;busy&gt; 692-696 &lt;Paseo&gt; 698-700 &lt;del&gt; 710-714 &lt;Prado&gt; 717-723 &lt;between&gt; 725-730 &lt;Puerta&gt; 732-734 &lt;del&gt; 736-738 &lt;Sol&gt; 740-742 &lt;and&gt; 744-749 &lt;Retiro&gt; 751-754 &lt;Park&gt; 757-761 &lt;Those&gt; 763-766 &lt;with&gt; 768-771 &lt;more&gt; 773-776 &lt;time&gt; 778-779 &lt;in&gt; 789-794 &lt;Madrid&gt; 797-802 &lt;either&gt; 804-809 &lt;before&gt; 811-812 &lt;or&gt; 814-818 &lt;after&gt; 820-823 &lt;side&gt; 825-829 &lt;trips&gt; 831-832 &lt;to&gt; 834-836 &lt;the&gt; 838-842 &lt;great&gt; 844-848 &lt;towns&gt; 850-851 &lt;of&gt; 861-867 &lt;Castile&gt; 870-874 &lt;might&gt; 876-882 &lt;explore&gt; 884-886 &lt;the&gt; 888-893 &lt;barrio&gt; 895-896 &lt;of&gt; 898-906 &lt;Salamanca&gt; 909-912 &lt;take&gt; 914-915 &lt;in&gt; 917-917 &lt;a&gt; 919-927 &lt;bullfight&gt; 930-931 &lt;or&gt; 941-945 &lt;visit&gt; 947-949 &lt;one&gt; 951-952 &lt;or&gt; 954-957 &lt;more&gt; 959-960 &lt;of&gt; 962-964 &lt;the&gt; 966-972 &lt;smaller&gt; 975-978 &lt;more&gt; 980-987 &lt;personal&gt; 989-995 &lt;museums&gt; 998-1001 &lt;only&gt; 1003-1003 &lt;a&gt; 1005-1008 &lt;ride&gt; 1018-1021 &lt;from&gt; 1023-1025 &lt;the&gt; 1027-1032 &lt;Puerta&gt; 1034-1036 &lt;del&gt; 1038-1040 &lt;Sol&gt; </code></pre>