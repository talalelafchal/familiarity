perl DBI comma in query name
<p>I am using perl to talk to an sqlite database, and am getting an error. I think it is because some of the chemical names (stored in the variable $drugs) have commas in them (they also have many other 'strange characters'.</p> <p>Any help would be appreciated, thanks. </p> <pre><code>**error message:** - read in 57to find CIDs for - Opened database successfully - retrieving results for cyclo(L-Val-L-Pro) - retrieving results for Sinapic_acid - retrieving results for NHQ - DBD::SQLite::db prepare failed: near ",": syntax error at get_drugName2IDinfo.sqlite.pl line 33. - DBD::SQLite::db prepare failed: near ",": syntax error at get_drugName2IDinfo.sqlite.pl line 33. </code></pre> <p><strong>line 33:</strong></p> <pre><code>my $stmt = qq(SELECT * from chem_aliases WHERE alias LIKE '$drug%'); </code></pre> <p><strong>example drug names:</strong></p> <pre><code>(2R,3R,4S,6R)-2-((5-hydroxy-2,2-dimethyl-3,4-dihydro-2H-benzo[h]chromen-6-yl)oxy)-6-(hydroxymethyl)tetrahydro-2H-pyran-3,4,5-triol </code></pre> <p><strong>partial script:</strong></p> <pre><code>my %HoDrugs; while (my $line=&lt;IN&gt;){ chomp $line; $HoDrugs{$line}=1; } close(IN); print "read in\t".scalar(keys %HoDrugs)."to find CIDs for\n"; ## my $driver = "SQLite"; my $database = "/Users/alisonwaller/Documents/Typas/ext_data/STITCHv3.1/STITCHv3.1.sqlite.db"; my $dsn = "DBI:$driver:dbname=$database"; my $userid = ""; my $password = ""; my $dbh = DBI-&gt;connect($dsn, $userid, $password, { RaiseError =&gt; 1 }) or die $DBI::errstr; print "Opened database successfully\n"; ### my $outfile="$in_drugNms.sq.plsCIDs.tab"; open (OUT,"&gt;",$outfile); foreach my $drug (keys %HoDrugs){ my $stmt = qq(SELECT * from chem_aliases WHERE alias LIKE '$drug%'); my $sth = $dbh-&gt;prepare( $stmt ); my $rv = $sth-&gt;execute() or die $DBI::errstr; if($rv &lt; 0){ print $DBI::errstr; } while(my @row = $sth-&gt;fetchrow_array()) { print "retrieving results for\t$drug\n"; print OUT join("\t",$drug,$row[0],$row[1],$row[2]) . "\n"; } } print "Operation done successfully\n"; $dbh-&gt;disconnect(); </code></pre>
<p>You could always try to use <code> $drug =~ s/[[:punct:]]//g; </code> before performing the query to try to remove punctuation characters?</p> <p>If you don't want that, maybe replace them with spaces? <code> $drug =~ s/,/ /g; </code></p>
<p>Have you tried using placeholders rather than just quoting the string yourself?</p> <pre><code>my $sth = $dbh-&gt;prepare( 'SELECT * from chem_aliases WHERE alias LIKE ?' ); my $rv = $sth-&gt;execute( $drug . '%' ) or die $DBI::errstr; </code></pre>