Saving check boxes choices with Perl and PostgreSQL
<p>I'm trying to create a user's preference page that has a bunch of check boxes letting the user decide how they want to receive their notifications. Here is my current HTML form for preferences:</p> <pre><code>&lt;form method="post"&gt; &lt;table id="preferences" class = "preferences"&gt; &lt;tr class="headers"&gt; &lt;th class = "preferences"&gt;Preference&lt;/th&gt; &lt;th class = "preferences"&gt;Value&lt;/th&gt; &lt;th class = "preferences"&gt;Notification Preferences&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td class = "preferences"&gt;Default Post Markup&lt;/td&gt; &lt;td class = "preferences"&gt; &lt;select name="default_markup"&gt; &lt;% foreach(USystem::Markup-&gt;markup_types) { print Usystem::Utils::option_tag($_-&gt;{id}, $_-&gt;{name}, $prefs-&gt;value(1)); } %&gt; &lt;/select&gt; &lt;/td&gt; &lt;td&gt; &lt;input type = "checkbox" name = "notification-option" id = "all-post"&gt; All Posts &lt;br/&gt; &lt;input type = "checkbox" name = "notification-option" id = "others-post"&gt; Other's Posts &lt;br/&gt; &lt;input type = "checkbox" name = "notification-option" id = "client-post"&gt; Cilent's Post &lt;br/&gt; &lt;input type = "checkbox" name = "notification-option" id = "assign-post"&gt; Task Assigned &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th colspan="3" class="submitrow"&gt;&lt;input type="submit" name="submit" value="Save Preferences" /&gt;&lt;/th&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; </code></pre> <p>I just added the 4 checkboxes and I need help saving them into the database where I use a boolean to determine if they are checked or not.</p> <p>My Perl script on the HTML page that runs when the "Save Preferences" button is selected:</p> <pre><code>my $form = $Request-&gt;Params; my $prefs = USystem::UserPrefs-&gt;new($user-&gt;userid); if($Request-&gt;{Method} =~ /POST/i) { my $dbh = USystem::DB-&gt;new; if($form-&gt;{submit} eq "Save Preferences") { $prefs-&gt;value($USER_PREF_MARKUPTYPE, $form-&gt;{default_markup}); $prefs-&gt;update; } $Response-&gt;Redirect('/preferences'); } </code></pre> <p>the $Request->Params is basically the same as CGI->Params()</p> <p>this is UserPrefs:</p> <pre><code>package USystems::UserPrefs; use strict; use USystems::DB; sub new { my $self = shift; my $class = ref($self) || $self; my $userid = shift; $self = bless {}, $class; $self-&gt;{dbh} = USystems::DB-&gt;new; if($userid) { $self-&gt;userid($userid); $self-&gt;__populate; } return $self; } sub __populate { my $self = shift; my $sth = $self-&gt;{dbh}-&gt;prepare("select prefid, value from user_preferences where userid=?"); $sth-&gt;execute($self-&gt;userid); while(my $href = $sth-&gt;fetchrow_hashref()) { $self-&gt;value($href-&gt;{PREFID}, $href-&gt;{VALUE}); } $sth-&gt;finish(); } sub update { my $self = shift; my $sth = $self-&gt;{dbh}-&gt;prepare("delete from user_preferences where userid=?"); $sth-&gt;execute($self-&gt;userid); $sth-&gt;finish; $sth = $self-&gt;{dbh}-&gt;prepare("insert into user_preferences(userid, prefid, value) values(?, ?, ?)"); while(my ($prefid, $value) = each %{$self-&gt;{PREFS}}) { $sth-&gt;execute($self-&gt;userid, $prefid, $value); } $sth-&gt;finish; } sub userid { my $self = shift; $self-&gt;{USERID} = shift if(@_); $self-&gt;{USERID}; } sub value { my $self = shift; my $prefid = shift; $self-&gt;{PREFS}-&gt;{$prefid} = shift if(@_); return $self-&gt;{PREFS}-&gt;{$prefid}; } 1 </code></pre> <p>How would I go about storing the values of whether the check boxes are checked or not as well as update my current Perl script to take in the values. I'm pretty new to Perl haven't had much luck. I'd be great if you can give an explanation to why you did what you did too. </p> <p>Please let me know if there's more information you need. Thanks</p>
<p>The line</p> <pre><code>my $prefs = USystem::UserPrefs-&gt;new($user-&gt;userid) </code></pre> <p>creates a new object and copies the current preferences for that user from the database. Afterwards you can acccess or update individual preferences using <code>$prefs-&gt;value(value_name [, new_value)</code>, and a call to <code>$prefs-&gt;update</code> will copy the current values back to the database</p> <p>You already have</p> <pre><code>$prefs-&gt;value($USER_PREF_MARKUPTYPE, $form-&gt;{default_markup}) </code></pre> <p>and you need to add more calls like that to set the values for other preferences before you call</p> <pre><code>$prefs-&gt;update </code></pre> <p>to save them all</p>