timeout for threads in perl
<p>I am writing a perl script to exit a thread after 5sec as shown below. but I am not able to print the message from if condition.</p> <p>Output of the script is Alarm clock</p> <p>How to print proper error messages from the parent process when timeout for threads.</p> <pre><code>#!/usr/bin/perl use strict; use warnings; use threads; my $th = threads-&gt;create( \&amp;sub1 ); my $thid = $th-&gt;tid(); eval { $SIG{'KILL'} = sub { if ( $th-&gt;is_running() ) { print "timed out, exiting the thread $thid\n"; $th-&gt;exit(); } }; alarm(5); $th-&gt;join(); }; sub sub1 { my $i = 0; while ( $i == 0 ) { } } </code></pre>
<p><a href="http://perldoc.perl.org/functions/alarm.html" rel="nofollow">Documentation says</a></p> <p>If you want to use alarm to time out a system call you need to use an eval/die pair.</p> <p>Alternatively you can use Sys::SigAction and do something like below</p> <pre><code>use Sys::SigAction qw( timeout_call ); if ( timeout_call( 5 ,sub { $retval = DoSomething( @args ); } ) { print "DoSomething() timed out\n" ; } </code></pre> <p>Edit: See the answer of mob to the question: <a href="http://stackoverflow.com/questions/6332885/perl-threads-with-alarm">Perl threads with alarm</a></p> <p>Also see the discussion on <a href="http://www.perlmonks.org/?node_id=899349" rel="nofollow"><strong>thread safe alarms</strong></a>.</p>