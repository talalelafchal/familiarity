Perl Script cant retrieve checkbox value
<p>I have the following Perl subs all in the same file -</p> <p>populate:</p> <pre><code>sub __populate { my $self = shift; my $sth = $self-&gt;{dbh}-&gt;prepare("select prefid, value, others_posts from user_preferences where userid=?"); $sth-&gt;execute($self-&gt;userid); while(my $href = $sth-&gt;fetchrow_hashref()) { $self-&gt;value($href-&gt;{PREFID}, $href-&gt;{VALUE}, $href-&gt;{OTHERS_POSTS}); } $sth-&gt;finish(); } </code></pre> <p>update:</p> <pre><code>sub update { my $self = shift; my $sth = $self-&gt;{dbh}-&gt;prepare("delete from user_preferences where userid=?"); $sth-&gt;execute($self-&gt;userid); $sth-&gt;finish; $sth = $self-&gt;{dbh}-&gt;prepare("insert into user_preferences(userid, prefid, value, others_posts ) values(?, ?, ?, ?)"); while(my ($prefid, $value, $others_posts) = each %{$self-&gt;{PREFS}}) { $sth-&gt;execute($self-&gt;userid, $prefid, $value, 'true'); } $sth-&gt;finish; } </code></pre> <p>and value:</p> <pre><code>sub value { my $self = shift; my $prefid = shift; $self-&gt;{PREFS}-&gt;{$prefid} = shift if(@_); return $self-&gt;{PREFS}-&gt;{$prefid}; } </code></pre> <p>Originally it was just <code>PREFID</code> and <code>VALUE</code> but I just added <code>OTHERS_POSTS</code> into the <code>populate</code> and <code>update</code> subs. The problem is that it doesn't seem to be returning anything for the <code>OTHERS_POSTS</code> that I just added. Every time the script runs, the values for <code>OTHERS_POSTS</code> doesn't get inserted into the table. I think the problem lies in my <code>value</code> sub but I'm fairy new with Perl and don't know how to modify it so that the value of <code>OTHERS_POSTS</code> gets extracted.</p>
<p><code>$self-&gt;{PREFS}</code> is a hash that originally had <code>prefid =&gt; value</code> pairs.</p> <p>if you wanna store <code>value</code> and <code>other_posts</code> in that hash modify:</p> <pre><code>sub value { my ($self,$prefid,$value,$otherposts) = @_; # set if( ! defined($value)) { $self-&gt;{PREFS}-&gt;{$prefid} = "$value|$otherposts"; } return $self-&gt;{PREFS}-&gt;{$prefid}; } </code></pre> <p>new version of update:</p> <pre><code>sub update { my $self = shift; my $sth = $self-&gt;{dbh}-&gt;prepare("delete from user_preferences where userid=?"); $sth-&gt;execute($self-&gt;userid); $sth-&gt;finish; $sth = $self-&gt;{dbh}-&gt;prepare("insert into user_preferences(userid, prefid, value, others_posts ) values(?, ?, ?, ?)"); for my $prefid (keys %{$self-&gt;{PREFS}}) { my ($value,$others_posts) = split '\|', $self-&gt;{PREFS}-&gt;{$prefid}; $sth-&gt;execute($self-&gt;userid, $prefid, $value, $others_posts); } $sth-&gt;finish; } </code></pre>
<p>Problem is that you have changed each preference from a simple key/value pair (prefid/value) to each key having two values (value &amp; othersposts). Need to change your data structure accordingly to support that. </p> <p>So each prefId key needs a hash containing VALUE &amp; OTHERPOSTS entries with the relevant values.</p> <p>Changes for this are:</p> <pre><code>sub update { my $self = shift; my $sth = $self-&gt;{dbh}-&gt;prepare("delete from user_preferences where userid=?"); $sth-&gt;execute($self-&gt;userid); $sth-&gt;finish; $sth = $self-&gt;{dbh}-&gt;prepare("insert into user_preferences(userid, prefid, value, others_posts ) values(?, ?, ?, ?)"); while(my ($prefid, $pref) = each %{$self-&gt;{PREFS}}) { $sth-&gt;execute($self-&gt;userid, $prefid, $pref-&gt;{VALUE}, $pref-&gt;{OTHERSPOSTS}); } $sth-&gt;finish; } sub value { my ($self,$prefid,$value,$othersposts) = @_; $self-&gt;{PREFS}-&gt;{$prefid} = { VALUE =&gt; $value , OTHERSPOSTS =&gt; $othersposts }; return $self-&gt;{PREFS}-&gt;{$prefid}; } </code></pre> <p>__populate() dosn't need changing as you are already passing the extra parameter to value()</p> <p>Haven't been able to actual run this so may be some syntex errors, but hopefully you get the idea.</p>