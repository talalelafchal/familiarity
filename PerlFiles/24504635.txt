Attach xlsx to email with MIME::Lite
<p>I am trying to send a email with an attached xlsx file using <a href="https://metacpan.org/pod/Excel%3a%3aWriter%3a%3aXLSX" rel="nofollow"><code>Excel::Writer::XLSX</code></a> and <a href="https://metacpan.org/pod/MIME%3a%3aLite" rel="nofollow"><code>MIME::Lite</code></a>. The generation of the excel file works, as i can scp and open the file in Excel without any problems. When i try to open the attachment from my email client (Outlook 2013) i get this error: </p> <blockquote> <p>"Excel cannot open the file "from_2014-06_to_2014-07.xlsx" because the file format or file extension is not valid. Verify that the file has not been corrupted and that the file extension matches the format of the file."</p> </blockquote> <p>The file size that outlook displays is 444B but its actually 95K. I have been sending xls files using <a href="https://metacpan.org/pod/Spreadsheet%3a%3aWriteExcel" rel="nofollow"><code>Spreadsheet::WriteExcel</code></a> and mime type "application/vnd.ms-excel" without any problems before.</p> <p>Here is what I have tried to send the email:</p> <pre><code>sub send_mail{ my $filename = shift; my $to_email = shift; my $from_email = shift; my $date = shift; $filename = shift; my $mail = MIME::Lite-&gt;new( 'From' =&gt; '$from_email', 'To' =&gt; $to_email, 'Subject' =&gt; "Radio/TV stats $date", 'Type' =&gt; 'multipart/mixed', #'content-type' =&gt; 'application/zip', #'Data' =&gt; "Here is your stuff", ); $mail-&gt;attach( 'Type' =&gt; 'TEXT', 'Data' =&gt; "Here is your stuff", ); $mail-&gt;attach( #'Type' =&gt; 'application/vnd.ms-excel', 'Type' =&gt; 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'Path' =&gt; $filepath, 'Filename' =&gt; $filename, 'Disposition' =&gt; 'attachement', ); $mail-&gt;send('sendmail'); } </code></pre> <p>Can anyone please help my attach the xlsx file?</p>
<p>You <code>shift</code> twice to <code>$filename</code> (2nd and 6th strings) and variable <code>$filepath</code> is not declared. May be here error?</p>