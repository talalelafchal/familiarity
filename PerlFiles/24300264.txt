Moving an open ssh session from one perl cgi script to the other
<p>I have a perl-cgi script that performs an SSH to a remote server and executes commands , now i want to pass this open ssh session to another perl-cgi script where it executes commands. I dont want to establish another SSH session in the new script. I am using Net::SSH::Expect and iam not allowed to use Net::OpenSSH. I tried passing the Net::SSH::Expect object created in the first script to the second script using HTTP GET method but it does not work. This is the first script that performs an SSH to the remote server.</p> <pre><code> my $ssh = Net::SSH::Expect-&gt; new ( host =&gt; $honame, password =&gt; $password, user =&gt; $name, raw_pty =&gt; 1, timeout =&gt; 4 ); open (MYFILE, '&gt;filedata.txt'); my $login_output=$ssh-&gt;login(); chomp $command; print MYFILE $ssh-&gt;exec("grep -d recurse -l ".$ipaddr." /local/configs/gis/extranet/apjc"); #$ssh-&gt;close; close(MYFILE); my $file = 'filedata.txt'; open my $info, $file or die "Could not open $file: $!"; #print header(); #print "Content-type: text/html\n\n"; print $q-&gt;header; print $q-&gt;start_html(-title =&gt; 'File List'); print "&lt;center&gt;&lt;h1&gt;Server Results &lt;/h1&gt;&lt;/center&gt;"; print "&lt;hr&gt;"; #print "&lt;form action="/cgi-bin/login_process.pl"&gt;"; print $q-&gt;start_form( -name =&gt; 'main_form', -method =&gt; 'POST', -enctype =&gt; &amp;CGI::URL_ENCODED, -onsubmit =&gt; 'return javascript:validation_function()', -action =&gt; '/cgi-bin/text_replace.pl', # Defaults to # the current program ); print "&lt;table border=1&gt;"; while( my $line = &lt;$info&gt;) { if ($line !~ /Permission denied/) { print "&lt;tr&gt;"; print "&lt;td&gt;"; print $line ." \n"; #print "&lt;input type="checkbox" name="vehicle" value="Bike"&gt;I have a bike&lt;br&gt;" print "&lt;/td&gt;"; print "&lt;td&gt;"; print checkbox('checkbox$i',1,$line,'File Replace '); print "&lt;/td&gt;"; print "&lt;td&gt;"; print "&lt;a href=\"http://localhost/cgi-bin/file_view.pl?variable=$line,$ssh\"&gt;View File Contents &lt;/a&gt;"; print "&lt;/td&gt;"; #print "&lt;hr&gt;"; $i++; print "&lt;/tr&gt;"; } } print "&lt;/table&gt;"; #print "&lt;/form&gt;"; print $q-&gt;submit( -name =&gt; 'submit_form', -value =&gt; 'Click here!', -onsubmit =&gt; 'javascript: validate_form()', ); print $q-&gt;end_form; </code></pre> <p>The second script is</p> <pre><code> #!"C:\cygwin64\bin\perl.exe" use CGI qw(:cgi-lib :standard); use Net::SSH::Expect; my $q=new CGI; print $q-&gt;header; print $q-&gt;start_html(-title =&gt; 'File Contents'); #print $q-&gt;param('variable'); my @values = split(',', $q-&gt;param('variable')); my $ssh=$valaues[1]; print $ssh-&gt;exec('ifconfig'); </code></pre>
<p>Establish the session in main. perform your processing in subroutines.</p> <p>Define each subroutine in its own package. Include those packages in the main script. Now all of your processing logic is in one runtime.</p> <p>Pass the SSH session object into the subroutines. </p>