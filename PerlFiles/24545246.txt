Perl's Mechanize and save_content()
<p>I'm trying to go paperless with all my utility bills, and that means downloading the statements from Suddenlink instead of stuffing the paper ones into a filing cabinet.</p> <p>I've used WWW::Mechanize before and I've liked it (Why did I try to do this stuff in LWP for so long?), and so I've went ahead and gotten a workable script ready. I can log in, navigate to the page that lists the pdf links, and loop through those.</p> <p>I do the following:</p> <pre><code>my $pdf = $mech-&gt;clone(); for my $link ($mech-&gt;find_all_links(url_regex =&gt; qr/viewstatement\.html/)) { [removed for brevity] unless (-f "Suddenlink/$year/$date.pdf") { $pdf-&gt;get($link-&gt;url); $pdf-&gt;save_content("Suddenlink/$year/$date.pdf", binary =&gt; 1); </code></pre> <p>When I compare one of these files with the same downloaded via Chrome, it's apparent what the problem is. Both files are identical on up to about 8-24 kbytes (it varies), but the Chrome pdf will be complete, and the perl-script pdf will be truncated.</p> <p>It's late, and there's nothing obviously wrong with the code. Google is turning up a few problems with save_content(), but not anything like what I'm getting.</p> <p>What am I doing wrong?</p>
<blockquote> <p>...[S]et <code>$mech-&gt;agent_alias()</code> to something. [Suddenlink is] doing a connection reset whenever they see a weird user agent string. â€“ John O 18 hours ago</p> </blockquote>