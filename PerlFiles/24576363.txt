Polish characters in Perl [HTML::TreeBuilder and utf8 input files]
<p>I have been working with this for a week now and I still cannot find working solution. I parse html file which contains polish letters encoded in UTF-8. After extracting information I am interested in I save them to a file or print to the console but all of the polish characters are not displayed properly.</p> <p>I have tried to use everything I found on Stack Overflow and other forums but things that work for other people for some reason don't work for me. I used:</p> <pre><code>use open qw(:std :utf8); use HTML::TreeBuilder qw( ); use Object::Destroyer qw( ); #and many others; </code></pre> <p>Here is my perl code:</p> <pre><code>use strict; use warnings; use feature 'say'; use HTML::TreeBuilder; use File::Find; use Encode; my $location="C:\\MyLocation"; open (MYFILE, '&gt;&gt;data.txt'); sub find_txt { my $F = $File::Find::name; if ($F =~ /index.html$/ ) { my $tr = HTML::TreeBuilder-&gt;new-&gt;parse_file('index.html'); for my $div ($tr-&gt;look_down(_tag =&gt; 'h2', 'class' =&gt; 'featured')) { say $div-&gt;as_text; print (MYFILE $div-&gt;as_text); } for my $div ($tr-&gt;look_down(_tag =&gt; 'div', 'class' =&gt; 'post-content')) { for my $t ($div-&gt;look_down(_tag =&gt; 'p')) { say $t-&gt;as_text; print (MYFILE $t-&gt;as_text); } } for my $div ($tr-&gt;look_down(_tag =&gt; 'h4', 'class' =&gt; 'related-posts')) { for my $t ($div-&gt;look_down(_tag =&gt; 'a')) { say $t-&gt;as_text; print (MYFILE $t-&gt;as_text); } } } } find(\&amp;find_txt, $location); close (MYFILE); </code></pre> <p>and here is the piece of html file which causes problems:</p> <pre><code>&lt;div class="post-content"&gt; &lt;p&gt;(łac. abacus)&lt;/p&gt; &lt;p&gt;1. płyta będąca najwyższą częścią kolumny&lt;/p&gt; &lt;p&gt;2. w starożytności &amp;#8211; deska do liczenia, pierwowzór liczydła&lt;/p&gt; </code></pre> <p>I am not sure if you will be able to display polish characters in your browser but the are some characters encoded by the unicode as 104, 106, 118, 141, 143, D3, 15A, 179, 17B, 105, 107, 119, 142, 144, F3, 15B, 17A, 17C</p>
<h2>HTML::TreeBuilder parse_file - charset autodetection</h2> <p>You may explicitly open file with given charset</p> <pre><code>... open (my $MYFILE, '&gt;&gt;:utf8','index.html'); # explicitly open MYFILE with utf8 charset ... my $tr = HTML::TreeBuilder-&gt;new-&gt;parse_file($MYFILE); ... </code></pre> <p><strong>OR</strong> Use IO::HTML for automatic charset detection of opened files.</p> <pre><code>... use IO::HTML; # exports html_file by default ... my $tr = HTML::TreeBuilder-&gt;new-&gt;parse_file(html_file('index.html')); .... </code></pre> <p>man HTML::TreeBuilder</p> <pre><code>parse_file .... When you pass a filename to "parse_file", HTML::Parser opens it in binary mode, which means it's interpreted as Latin-1 (ISO-8859-1). If the file is in another encoding, like UTF-8 or UTF-16, this will not do the right thing. .... SEE ALSO .... For opening a HTML file with automatic charset detection: IO::HTML. </code></pre>