File::stat returns &quot;No such file or directory&quot;
<p>When I run this program:</p> <pre><code>#!/usr/bin/perl -w use File::Find; use File::stat; use Time::gmtime; use Fcntl ':mode'; my %size = (); my @directory = ('.'); find( sub { my $st = stat($File::Find::name) or die "stat failed for $File::Find::name : $!"; if ( defined $st ) { my $gm = gmtime $st-&gt;mtime; $size{$gm-&gt;year + 1900} += $st-&gt;blksize unless S_ISDIR($st-&gt;mode); } else { print "stat failed for ", $File::Find::name, ": $!\n"; } }, @directory); foreach my $year (keys %size) { print "$year ", $size{$year}, "\n"; } </code></pre> <p>I get <code>stat failed for ./1128/00 : No such file or directory at ./size.pl line 13.</code>. But, when I list it, it's there:</p> <pre><code># ls ./1128/00 03 05 07 09 12 14 18 20 22 24 27 29 32 34 37 40 43 45 47 50 52 54 57 59 63 65 67 69 75 78 81 83 85 88 90 92 95 04 06 08 11 13 15 19 21 23 25 28 31 33 35 39 41 44 46 48 51 53 55 58 61 64 66 68 71 77 79 82 84 86 89 91 93 </code></pre> <p>Based on diagnostics that I have removed for this question, I can see that it does successfully stat the first 4 files and the <code>.</code> directory and <code>1128</code> directory (parent to <code>1128/00</code>). It always successfully stats the same files and directories and fails on <code>1128/00</code>. Why is it failing?</p>
<p>By default, <a href="http://perldoc.perl.org/File/Find.html" rel="nofollow"><code>File::Find</code></a> will <a href="http://perldoc.perl.org/functions/chdir.html" rel="nofollow"><code>chdir</code></a> to each directory as it recurses.</p> <p>Because of this, performing <a href="http://perldoc.perl.org/functions/stat.html" rel="nofollow"><code>stat</code></a> on the <code>$File::Find::name</code> value of <code>./1128/00</code> is actually looking for the file <code>./1128/./1128/00</code>, which does not exist.</p> <p>To get the behavior that you want, simply perform your file operations on the <code>$_</code> variable.</p> <pre><code>my $st = stat($_) or die "stat failed for $_: $!"; </code></pre>