Retrieving Javascript Variable to use in Perl
<p>I have a html table with something like this:</p> <pre><code>&lt;table class="notices-table" width="100%" cellpadding="0" cellspacing="0" border="0"&gt; &lt;% foreach my $notice (@regular_posts) { %&gt; &lt;form method = "post" id = "post-form-&lt;%= $notice-&gt;notice_id()%&gt;"&gt; &lt;tr class = "click-post" href = "&lt;%= $notice-&gt;link() %&gt;"&gt; &lt;td&gt;&lt;b&gt;Date Posted: &lt;/b&gt; &lt;%= '' . (split(/\./, $notice-&gt;created()))[0] %&gt;&lt;br/&gt; &lt;b&gt;Title: &lt;/b&gt;&lt;%= $notice-&gt;title() %&gt;&lt;br/&gt;&lt;br/&gt; &lt;%= $notice-&gt;content() %&gt; &lt;/td&gt; &lt;td&gt;&lt;button class = "archive-button" id="archive-button"&gt;Archive&lt;/button&gt;&lt;/td&gt; &lt;/tr&gt; &lt;input type="hidden" id="action" name="action" value="archive" /&gt; &lt;/form&gt; &lt;% } %&gt; &lt;/table&gt; </code></pre> <p>and then I have a javascript code that triggers when the "archive" button is hit for each that atempts to retrieve the "notice_id":</p> <pre><code>$(document).ready(function() { $('button.archive-button').bind('click', function() { var id = $(this).attr('id'); var parts = id.split(/-/); var notice_id = parts[2]; var post_form_id = '#post-form-' + notice_id; $(post_form_id).submit(); var path_name = window.location.pathname; $.ajax(path_name, { type: 'POST' data: { 'notice_id2' : notice_id }, success: function(data) { console.log('/takeNotice called successfully:'); console.log(data); }, error: function(jqXHR, textStatus, err) { console.error('/takeNotice call failed:'); console.error(err); } }); return false; }); </code></pre> <p>});</p> <p>I want to pass the "notice_id" into a Perl script which will use the id to retrieve the correct post from the database so that it will archive it:</p> <pre><code>my $cgi = CGI-&gt;new; my $notice_id = $cgi-&gt;param("notice_id2"); my $form = $Request-&gt;Params(); my $notice; eval { $notice = Taskman::Notice-&gt;new(notice_id =&gt; $notice_id); }; </code></pre> <p>I'm pretty new to Perl and Javascript/Ajax so I probably have more problems in here. Any insight would be great. Thanks</p> <p><strong><em>EDITED</em></strong> I've made some modifications to my code. Ajax seems to be working but I cant tell if I am still invoking it right or not. The scripts are on the same page. I am still retrieving the wrong "notice_id"</p>
<p>There's nothing fundamentally wrong with your approach, but you're not invoking <code>$.ajax</code> correctly, which will prevent anything from working.</p> <p>Specifically, you're not providing a URL for your Perl script. For the sake of example, I'll assume your Perl script lives at the path <code>/takeNotice</code> (clever, no?). You would call it like this:</p> <pre><code>$.ajax('/takeNotice', { type: 'POST', data: { notice_id2 : notice_id }, success: function(data) { console.log('/takeNotice called successfully:'); console.log(data); }, error: function(jqXHR, textStatus, err) { console.error('/takeNotice call failed:'); console.error(err); } }); </code></pre> <p>The <code>success</code> and <code>error</code> functions are not strictly necessary, but it's a good idea to include them, and certainly when you're learning, it really helps understand the flow of your front-end logic.</p> <p>Speaking of which, you should probably also add some error handling to this code:</p> <pre><code>var parts = id.split(/-/); var notice_id = parts[2]; var post_form_id = '#post-form-' + notice_id; </code></pre> <p>If the ID is not in the format you expect it to be, you will end up with a <code>post_form_id</code> of <code>"#post-form-undefined</code>. Some error handling and console logging would be useful here.</p> <p>Lastly, this line does nothing:</p> <pre><code>$(post_form_id '#action').val('archive'); </code></pre> <p>If you're trying to set the value, you need a second parameter. If you're trying to get the value, you should probably assign it to something.</p>