comparing and extracting attributes and saving in array using perl TWIG
<p>I am having a huge xml file only a part i am pasting here:</p> <pre><code>&lt;List NAME="ANDREW" ENROLED="2" FEE="640" CONFORMATION="I"&gt; &lt;DATA&gt; &lt;HOUSE&gt; &lt;PRIMARY GROUP_ID="37496" SECTION="A"/&gt; &lt;PRIMARY GROUP_ID="37496" SECTION="B"/&gt; &lt;/HOUSE&gt; &lt;/DATA&gt; &lt;/List&gt; &lt;List NAME="SAM" ENROLED="4" FEE="640" CONFORMATION="O"&gt; &lt;DATA&gt; &lt;HOUSE&gt; &lt;PRIMARY GROUP_ID="36816" SECTION="A"/&gt; &lt;PRIMARY GROUP_ID="36816" SECTION="B"/&gt; &lt;/HOUSE&gt; &lt;/DATA&gt; &lt;/List&gt; &lt;List NAME="MATHEW" ENROLED="3" FEE="467" CONFORMATION="I"&gt; &lt;DATA&gt; &lt;HOUSE&gt; &lt;PRIMARY GROUP_ID="37436" SECTION="A"/&gt; &lt;PRIMARY GROUP_ID="37436" SECTION="B"/&gt; &lt;/HOUSE&gt; &lt;/DATA&gt; &lt;/List&gt; &lt;List NAME="RAY" ENROLED="1" FEE="982" CONFORMATION="O"&gt; &lt;DATA&gt; &lt;HOUSE&gt; &lt;PRIMARY GROUP_ID="36892" SECTION="A"/&gt; &lt;PRIMARY GROUP_ID="36892" SECTION="B"/&gt; &lt;/HOUSE&gt; &lt;/DATA&gt; &lt;/List&gt; </code></pre> <p>I am using xml::TWIG </p> <p>i have to check if "CONFORMATION" is I then get the "FEE" and "GROUP_ID" and store in seperate array also if "Conformation" is "O" then get the "FREE" and "GROUP_ID" and store them in different array.</p> <pre><code>use XML::Twig; my $filename = 'report2.txt'; open( $fh, '&gt;', $filename ); my $twig = new XML::Twig( twig_roots =&gt; { "List" =&gt; \&amp;add, "List/DATA/HOUSE/PRIMARY" =&gt; \&amp;update } ); $twig-&gt;parsefile("file.xml"); #$twig-&gt;print; sub add { my ( $twig, $add ) = @_; # handlers params are always $cond = $add-&gt;att('CONFORMATION'); $cond2 = $add-&gt;att('FEE'); if ( $cond == 'I' ) { sub update { my ( $twig, $update ) = @_; $check = $update-&gt;att('GROUP_ID'); print $fh " GROUP_ID :$check "; } } elsif ( $cond == 'O' ) { sub update { my ( $twig, $update ) = @_; $check = $update-&gt;att('GROUP_ID'); print $fh " GROUP_ID :$check "; } print $fh "CONFORMATION=$cond \n GROUP_ID : $cond2"; } } close $fh; print "done\n"; </code></pre> <p>right now i am just trying to print them in log so futher i can move. but got screwed up.</p> <p>please help i am begineer to PERL my code is lyke this which is printing all of them but not in sequence.</p>
<p>Ok, firstly - move that <code>update</code> sub outside the <code>add</code> sub. That's just dirty. </p> <p>XML::Twig works on having 'handlers' that 'fire off' to parse segments of XML code. It's a really lightweight way of working on a large file, because on of the common problems with XML is that it's really memory hungry. </p> <p>You're overcomplicating what you're doing though. </p> <pre><code>#!/usr/bin/perl use strict; use warnings; use XML::Twig; sub process_list { my ( $twig, $list ) = @_; my $conformation = $list -&gt; att( 'CONFORMATION' ); my $fee = $list -&gt; att ( 'FEE' ); foreach my $primary ( $list -&gt; first_child ( 'DATA' ) -&gt; first_child ('HOUSE') -&gt; children() ) { my $group_id = $primary -&gt; att ( 'GROUP_ID' ); print "$conformation, $fee, $group_id\n"; ### here you have the information you need to do the rest of your processing. } } my $parser = XML::Twig -&gt; new ( 'twig_handers' =&gt; { 'List' =&gt; \&amp;process_list} ); $parser -&gt; parsefile ( $xml_file ); </code></pre> <p>the 'handler' is triggered each time the parser sees a 'List' element, and then you can extract the subelements and attributes you need. <code>children</code> gives a list of elements to cycle. </p>