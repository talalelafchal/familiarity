Annotation retrievals with lpOD
<p>I have this block in <code>content.xml</code> of my <code>test.odt</code> file :</p> <pre><code>&lt;office:body&gt;&lt;office:text&gt;&lt;text:sequence-decls&gt;&lt;text:sequence-decl text:display-outline-level="0" text:name="Illustration"/&gt;&lt;text:sequence-decl text:display-outline-level="0" text:name="Table"/&gt;&lt;text:sequence-decl text:display-outline-level="0" text:name="Text"/&gt;&lt;text:sequence-decl text:display-outline-level="0" text:name="Drawing"/&gt;&lt;/text:sequence-decls&gt;&lt;text:p text:style-name="Standard"/&gt;&lt;text:p text:style-name="Standard"&gt;Hello &lt;office:annotation office:name="__Fieldmark__4_822755319"&gt;&lt;dc:creator&gt;Unknown Author&lt;/dc:creator&gt;&lt;dc:date&gt;2014-06-06T09:29:21.051317276&lt;/dc:date&gt;&lt;text:list text:style-name=""&gt;&lt;text:list-item&gt;&lt;text:p text:style-name="P1"&gt;&lt;text:span text:style-name="T1"&gt;This is a comment&lt;/text:span&gt;&lt;/text:p&gt;&lt;/text:list-item&gt;&lt;/text:list&gt;&lt;/office:annotation&gt;World&lt;office:annotation-end office:name="__Fieldmark__4_822755319"/&gt;, Hello Simple ODF!&lt;/text:p&gt;&lt;/office:text&gt;&lt;/office:body&gt; </code></pre> <p>I'm trying to use the Perl <a href="http://search.cpan.org/~jmgdoc/ODF-lpOD-1.121/lpOD/Tutorial.pod" rel="nofollow">ODF::lpOD</a> library. For example I'm able to extract the content of the main paragraph :</p> <pre><code>use ODF::lpOD; $doc = odf_get_document("test.odt") or die "Failed to load the document\n"; $contenu = $doc-&gt;get_body; $p = $contenu-&gt;get_paragraph(position=&gt;-2); $texte = $p-&gt;get_text; print $texte output&gt; Hello World, Hello Simple ODF! </code></pre> <p>But I'm not able to use the <code>get_annotation</code> function to extract the information about the annotation. For example, one of my attempts:</p> <pre><code>use ODF::lpOD; $doc = odf_get_document("test.odt") or die "Failed to load the document\n"; $contenu = $doc-&gt;get_body; $p = $contenu-&gt;get_paragraph(position=&gt;-2); print "\n"; $annot = $p-&gt;get_annotations; # output is the same with $annot=$contenu-&gt;get_annotations print $annot output&gt; 1 </code></pre> <p>What is this <code>1</code> ? I'd like to use the functions <code>get_date</code>, <code>get_author</code>, etc, to get the information about the annotation. </p>
<p>From <code>man ODF::lpOD::TextElement</code>:</p> <pre><code>"get_annotations()" always returns a list </code></pre> <p>You're using the function in a scalar context, so instead of the list you're seeing the number of elements in the list, which is just 1. If we run this example program and look at the output, you can see what the document structure is:</p> <pre><code>#!/usr/bin/perl -w # -Ian! D. Allen - idallen@idallen.ca - www.idallen.com use strict; use ODF::lpOD; my $doc = odf_new_document('text') or die "$0: Failed to create new text\n "; my $content = $doc-&gt;get_part(CONTENT) or die; my $context = $content-&gt;get_body or die; $context-&gt;append_element( odf_paragraph-&gt;create( style =&gt; "Standard", text =&gt; "Hello World !" ) ); my $p = $context-&gt;get_paragraph(position=&gt;1) or die; my $t = $p-&gt;get_text or die; print "$t\n"; $p-&gt;set_annotation( text =&gt; "This is an annotation.", after =&gt; "World", ) or die; my @as = $p-&gt;get_annotations() or die; for my $a ( @as ) { &amp;Dump("", $a); } sub Dump { my $k = shift; my $v = shift || ''; if ( ref($v) ne '' ) { for my $k2 ( keys %{$v} ) { my $v2 = $$v{$k2}; if ( $k2 ne 'parent' &amp;&amp; $k2 ne 'last_child' &amp;&amp; $k2 ne 'prev_sibling' ) { my $r = &amp;Pretty($v); print "$k $r\[$k2] =&gt; "; &amp;Dump("$k $r", $v2); } } } else { print " $v\n"; } } sub Pretty { my $r = shift; local $_ = ref($r); s/ODF::lpOD:://; return $_; } $doc-&gt;save(target =&gt; "helloworld.odt"); exit; </code></pre> <hr> <p><strong>OUTPUT:</strong></p> <pre><code>Hello World ! Annotation[next_sibling] =&gt; Annotation TextNode[next_sibling] =&gt; Annotation TextNode[gi] =&gt; 1 Annotation TextNode[pcdata] =&gt; ! Annotation[gi] =&gt; 29 Annotation[style] =&gt; Annotation[first_child] =&gt; Annotation Element[next_sibling] =&gt; Annotation Element Element[next_sibling] =&gt; Annotation Element Element Paragraph[gi] =&gt; 28 Annotation Element Element Paragraph[first_child] =&gt; Annotation Element Element Paragraph TextNode[next_sibling] =&gt; Annotation Element Element Paragraph TextNode[gi] =&gt; 1 Annotation Element Element Paragraph TextNode[pcdata] =&gt; This is an annotation. Annotation Element Element Paragraph[next_sibling] =&gt; Annotation Element Element[gi] =&gt; 15 Annotation Element Element[first_child] =&gt; Annotation Element Element TextNode[pcdata] =&gt; 2016-06-11T05:04:36 Annotation Element Element TextNode[next_sibling] =&gt; Annotation Element Element TextNode[gi] =&gt; 1 Annotation Element[gi] =&gt; 17 Annotation Element[first_child] =&gt; Annotation Element TextNode[gi] =&gt; 1 Annotation Element TextNode[next_sibling] =&gt; Annotation Element TextNode[pcdata] =&gt; idallen </code></pre>