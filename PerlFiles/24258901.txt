openSSH - can't call method capture
<p>I'm working around with the <a href="https://metacpan.org/pod/Net%3a%3aOpenSSH" rel="nofollow"><code>NET::OpenSSH</code></a> module from PERL. I tried it on simple scripts and it's working perfectly.</p> <p>Now i'm including it in a bigger script :</p> <pre><code>switch ($ARGV[2]) { case "OBS" { my $ssh = Net::OpenSSH-&gt;new("$user:$passwdobs\@$ARGV[1]"); if ($ssh-&gt;error) { print ERR_REPORT_SSH "Echec ssh sur " . $ARGV[1] . " erreur a gerer plus tard\n"; die "Echec du ssh sur " . $ARGV[1] . "\n"; } } </code></pre> <p>I have 2 others cases similar to this one, only the "case "OBS"" is changing, and the password with it. the variable $ssh is NEVER uninitialized.</p> <p>Further in the script, i wrote this :</p> <pre><code>open(SSHCONFIG, "/tech/gtr/scripts/osm/environnement_qualif/scan-rh2/bin/ssh.conf"); while (&lt;SSHCONFIG&gt;) { @ligne = split(/;/, $_ ); $listop = $ligne[0]; $listcmd = $ligne[1]; $fileprefix = $ligne[2]; if ($listop =~ /$operateur/) { print "l'operateur match\n" . "commande : " . $listcmd . "\n"; #sendCommand($listcmd, $fileprefix); my $out1 = $ssh-&gt;capture($listcmd); print $out1 ; } else { next; } } </code></pre> <p>While there's something in the "ssh.conf" file, the script should execute the command given in the file. But, when started, the script stops with this error :</p> <pre><code>l'operateur match commande : show arp Can't call method "capture" on an undefined value at sshscript.pl line 65, &lt;SSHCONFIG&gt; line 1. </code></pre> <p>My $listcmd variable is not empty as you can see. Why can't it call the capture method? Thanks.</p>
<p>The variable <code>$ssh</code> goes out of scope at the end of the <code>case "OBS"</code> block.</p> <p>That kind of errors can be easily caught enabling strictures at the beginning of your script:</p> <pre><code>use strict; use warnings; </code></pre> <p>BTW, don't use <code>Switch</code>, it is broken-by-design and may introduce hard to find bugs on your scripts.</p>