Empty Session Creating on every Refresh
<p>Every time I refresh my page an empty session gets created. </p> <p>Index.cgi</p> <pre><code> #!perl.exe use strict; use warnings; use DBI; use CGI; use database; use Digest::MD5 qw(md5 md5_hex md5_base64); use Data::Dumper; use CGI::Session; my $q = new CGI; my $session = new CGI::Session(); my $db=database-&gt;new(); print $q-&gt;header; $session = CGI::Session-&gt;load(); my $first_name = $session-&gt;param("userid"); my $login_fail=$q-&gt;param("attempt"); &lt;div class='login_form' style=''&gt; &lt;form method='post' action='Session.cgi'&gt; &lt;table&gt; END_HTML if ($session-&gt;is_empty) { print &lt;&lt;END_HTML; &lt;tr class='l_form_input'&gt; &lt;td&gt;&lt;input type='text' name='userid' placeholder='Email or Phone'/&gt;&lt;/td&gt; &lt;td&gt;&lt;input type='password' name='password' placeholder='Password'/&gt;&lt;/td&gt; &lt;td&gt;&lt;input type='submit' name='submit' value='Log In'/&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&lt;span&gt;&lt;a href='reg.cgi'&gt;Not A Member Yet?&lt;/a&gt;&lt;/span&gt;&lt;/td&gt; &lt;td&gt;&lt;span&gt;&lt;a href='forgot.cgi'&gt;Forget your password?&lt;/a&gt;&lt;/span&gt;&lt;/td&gt; &lt;/tr&gt; END_HTML if (defined($login_fail)) { print "&lt;tr&gt;&lt;td colspan='2'&gt;Incorrect Login&lt;td&gt;&lt;/tr&gt;"; } }else { print &lt;&lt;END_HTML; &lt;tr class='l_form_input'&gt; &lt;td&gt;&lt;span&gt;Logged in as $first_name&lt;/span&gt;&lt;/td&gt; &lt;td&gt;&lt;span&gt;&lt;a href='logout.cgi'&gt;logout&lt;span&gt;&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; END_HTML } print &lt;&lt;END_HTML; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; </code></pre> <p>Session.cgi</p> <pre><code>#!perl.exe use strict; use warnings; use database; use DBI; use CGI; use Digest::MD5 qw(md5 md5_hex md5_base64); my $q = new CGI; my $db=database-&gt;new(); #print $q-&gt;header; my $email=$q-&gt;param("userid"); my $password=$q-&gt;param("password"); $password = md5_hex($password); my $flag=$db-&gt;login_flag($email,$password); if($flag == 1) { require CGI::Session; my $session = CGI::Session-&gt;new(); print $session-&gt;header(); $session-&gt;param("userid", $email); $session-&gt;flush(); print "&lt;META HTTP-EQUIV=refresh CONTENT=\"1;URL='http://localhost/website/index.cgi\"&gt;\n"; } else { print $q-&gt;header; print "&lt;META HTTP-EQUIV=refresh CONTENT=\"1;URL='http://localhost/website/index.cgi?attempt=login_fail\"&gt;\n"; } </code></pre>
<p>Pass the <a href="https://metacpan.org/pod/CGI" rel="nofollow"><code>CGI</code></a> object when creating the new <a href="https://metacpan.org/pod/CGI::Session" rel="nofollow"><code>CGI::Session</code></a>:</p> <pre><code>my $session = CGI::Session-&gt;new($q) or die CGI-&gt;Session-&gt;errstr; </code></pre> <p>Otherwise, you're just creating an anonymous session each time that is not dependent on the user's information.</p>