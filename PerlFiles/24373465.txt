Decrement scalar Perl variable everytime an ajax script is ran
<p>On my page there is a header with a notification button that shows the number of unarchived notifications given by this Perl code: </p> <pre><code>@notices_posts = System::Notice-&gt;fetch_all_posts(userid =&gt; $user-&gt;userid(), visible =&gt; 1); @regular_posts = sort { $a-&gt;created() cmp $b-&gt;created() } grep { !$_-&gt;important() } @notices_posts; </code></pre> <p>and displayed with this in the header:</p> <pre><code>&lt;b&gt;&lt;%= (scalar @regular_posts) %&gt;&lt;/b&gt; </code></pre> <p>I have an ajax script:</p> <pre><code>$(document).on('click', '.archive-button', function(){ var notice_id = $(this).data('notice_id'); var archiveaddress = '/user/notices/archivenotice/' + notice_id; var archived_notice = 'tr.notification-' + notice_id; $.post(archiveaddress, {notice_id: notice_id}).done(function(){ $(archived_notice).css("background" , "#F2F2F2"); }); }); </code></pre> <p>which runs everytime someone clicks the "archive" button on a notice. I currently have it so that the notice becomes grayed out when the perl script for archiving is successfully run but I also want it to update the scalar number in the header displaying the number of unarchived notices everytime the user archives something. Something that will decrement the displayed value possibly everytime the ajax script is ran.</p>
<p>I'd give the element an ID and use JQuery to set the number.</p> <pre><code>&lt;b id="incme"&gt;&lt;%= (scalar @regular_posts) %&gt;&lt;/b&gt; ... $(document).on('click', '.archive-button', function(){ var notice_id = $(this).data('notice_id'); var archiveaddress = '/user/notices/archivenotice/' + notice_id; var archived_notice = 'tr.notification-' + notice_id; $.post(archiveaddress, {notice_id: notice_id}).done(function(){ $(archived_notice).css("background" , "#F2F2F2"); $('#incme').html(parseInt($('#incme').html(), 10)+1) }); }); </code></pre> <p>Reference: <a href="http://stackoverflow.com/questions/7698729/jquery-increment-value-of-span-tag">jQuery increment value of &lt;span&gt; tag</a></p>