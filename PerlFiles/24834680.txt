Threading with PERL in Irssi
<p>The thread module for PERL does not seem to work with Irssi. I can't get more information on this because the folk at #Irssi never respond.</p> <p>I need to have the script check a database every 5 minutes. Now I thought this would be possible with multi-threading in PERL, but once you include the module Irssi will thrown an Exception.</p> <p>Ironically, if I try and construct a while loop that terminates itself after a set amount of time the Irssi client just hangs.</p> <p>Any suggestions?</p> <p>Code</p> <pre><code> use strict; use warnings; use threads; use Thread::Queue; my $q = Thread::Queue-&gt;new(); # A new empty queue # Worker thread my $thr = threads-&gt;create( sub { # Thread will loop until no more work while (defined(my $item = $q-&gt;dequeue())) { # Do work on $item } } ); </code></pre> <p>Errors in Irssi (not all of them, but same thing, cant locate package):</p> <pre><code>13:30| Can't locate package Irssi::ServerSetup for @Irssi::Irc::ServerSetup::ISA at /home/nullby7e/.irssi/scripts/test.pl line 27. 13:30| 13:30| Can't locate package Irssi::Nick for @Irssi::Irc::Nick::ISA at /home/nullby7e/.irssi/scripts/test.pl line 27. 13:30| 13:30| Can't locate package Irssi::ServerConnect for @Irssi::Irc::ServerConnect::ISA at /home/nullby7e/.irssi/scripts/test.pl line 27. </code></pre>
<p>I can't help you with threads, but according to <a href="http://www.irssi.org/documentation/perl" rel="nofollow">Irssi Perl Scripting Reference</a> you want the <code>Irssi::timeout_add</code> function.</p> <p>You can find many examples how to use it at <a href="http://scripts.irssi.org/" rel="nofollow">Irssi's Script Repository</a>. Basic usage is:</p> <pre><code>use Irssi; sub check_database { ... } Irssi::timeout_add(5*60*1000, "check_database", undef); </code></pre>