Error messages after creating a new linux user
<p>I have created a new debian user using a Perl script with the CPAN module <a href="https://metacpan.org/pod/Unix%3a%3aPasswd%3a%3aFile" rel="nofollow"><code>Unix::Passwd::File</code></a> (I have used this module because i've been asked to create the user without using <code>adduser</code> or <code>useradd</code>). </p> <p>This module creates the user by adding the lines in:</p> <ul> <li><code>/etc/passwd</code></li> <li><code>/etc/shadow</code></li> <li><code>/etc/group</code></li> <li><code>/etc/gshadow</code></li> </ul> <p>Then the Perl script creates the home directory using:</p> <pre><code>mkdir $directory; chown $user, $directory; </code></pre> <p>After this I tried to log in and got the following error messages:</p> <pre><code>Could not update ICEauthority file /home/user/.ICEauthority There is a problem with the configuration server.(/usr/lib/libgconf2-4/gconf-sanity-check-2 exited with status 256) Nautilus could not create the following required folders: /home/user/Desktop, /home/user/.nautilus </code></pre> <p>What am I missing here?</p> <p>Thanks in advance.</p>
<p><code>chown</code> is failing because you aren't giving it the correct arguments. The return value is the number of files modified so you can use that to check for success:</p> <pre><code>chown "user", "file" or die "Couldn't chown"; </code></pre> <p>The correct arguments for <a href="http://perldoc.perl.org/functions/chown.html" rel="nofollow"><code>chown</code></a> are: </p> <pre><code>chown $uid, $gid, @filenames; </code></pre> <p>e.g.</p> <pre><code>chown 123, 456, "/home/user"; chown 123, -1, "/home/user"; # Don't change the group id </code></pre> <p>The user and group ids of the newly created user can be extracted from the result of <a href="https://metacpan.org/pod/Unix%3a%3aPasswd%3a%3aFile#add_user-args---status-msg-result-meta" rel="nofollow"><code>Unix::Passwd::File::add_user</code></a>:</p> <pre><code>my $result = add_user( ... ); if ($result-&gt;[0] == 200) { # Success my $uid = $result-&gt;[2]-&gt;{'uid'}; my $gid = $result-&gt;[2]-&gt;{'gid'}; ... } </code></pre>