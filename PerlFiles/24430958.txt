Can not generate pdf using PDF Reuse and Template Toolkit when variable contains a utf8 character
<p>I have been stuck at this for too long.</p> <p>I am generating PDF invoices using <a href="https://metacpan.org/pod/PDF%3a%3aReuse" rel="nofollow"><code>PDF::Reuse</code></a> and <a href="https://metacpan.org/pod/distribution/Template-Toolkit/lib/Template/Toolkit.pod" rel="nofollow"><code>Template::Toolkit</code></a>. Now here is the issue; when I retrieve a DB record (using DBIx) that contains a utf8 character, the PDF gets corrupted. Here is the code that generates the PDF:</p> <pre><code>sub create_pdf { my ( $self, $pdf_template, $vars ) = @_; my $path = $ENV{NEW_DIR} . '/OTTCatalyst/root/templates/pdf/'; my $tt = Template-&gt;new({ INCLUDE_PATH =&gt; $path, PLUGIN_BASE =&gt; 'OTT::Template::Plugin', PRE_CHOMP =&gt; 3, POST_CHOMP =&gt; 3, LOAD_PERL =&gt; 1, }); my $template = read_file( $path.$pdf_template, binmode =&gt; ':utf8' ); my ( $output, $stdout, $stderr ); { local $CWD = $path; capture { $tt-&gt;process( \$template, $vars, \$output, binmode =&gt; ':utf8') } \$stdout, \$stderr; } throw_fatal 'There is an error with the template: '.$tt-&gt;error if not $stdout; return $stdout; } </code></pre> <p><code>$vars</code> is the variable that contains the DBIx row object that contains the data with the UTF8 character in it.</p> <p>To be more exact the variable that contains the utf8 character is: </p> <p><code>$vars-&gt;{invoice}-&gt;customer-&gt;addr1</code> </p> <p>if I just display the addr1 as is, the PDF will get corrupted. If I wrap it around:</p> <p><code>encode_utf8($vars-&gt;{invoice}-&gt;customer-&gt;addr1);</code></p> <p>It will show: <code>III Å ̈ 1/1, 2nd floor</code> </p> <p>What is should show is: <code>III Ũ 1/1, 2nd floor</code> </p> <p>Can anybody help me with this. If anything is unclear please let me know.</p> <p>Thanks in advance</p>
<p>You probably need to decode the data that you are reading from your database. If you read the documentation for your DBD (I don't know which database you're using) then there's probably an option for auto-decoding any text fields as they are fetched.</p>