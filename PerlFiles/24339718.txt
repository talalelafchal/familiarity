Perl module - dist.ini and platform specific prereqs
<p><strong>How can I add conditional prereqs to <code>dist.ini</code> for each platform (Windows/Non windows) I want the module to support?</strong></p> <p>For example in perl code I could do:</p> <pre><code>if ( $^0 eq 'MSWin32' ){ require Win32::Foo; }else{ require Bar::Baz; } </code></pre> <p>How do I cater to each system/platform like this in <code>dist.ini</code> so that the proper prereqs are installed via cpan/cpanm?</p>
<p>You can't do it in <code>dist.ini</code>, since an ini file doesn't really have any way to do conditional logic. But one way might be to write your own Dist::Zilla plugin, something like this:</p> <pre><code>package Dist::Zilla::Plugin::MyPrereqs; # pick a better name use Moose; with 'Dist::Zilla::Role::PrereqSource'; sub register_prereqs { my $self = shift; my %prereqs; if ( $^0 eq 'MSWin32' ) { $prereqs{'Win32::Foo'} = '0.12'; # min. version } else { $prereqs{'Bar::Baz'} = '1.43'; } $self-&gt;zilla-&gt;register_prereqs( %prereqs ); } </code></pre> <p>If you generalize this to take some platform-dependent lists of prereqs within <code>dist.ini</code>, it would make a good CPAN release.</p>
<p>Use <a href="https://metacpan.org/pod/Dist::Zilla::Plugin::OSPrereqs" rel="nofollow">Dist::Zilla::Plugin::OSPrereqs</a>. For your example it would look like:</p> <pre><code>[OSPrereqs / MSWin32] Win32::Foo = 0.12 [OSPrereqs / !MSWin32] Bar::Baz = 1.43 </code></pre>