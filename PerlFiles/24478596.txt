DateTime compare issues with InflateColumn::DateTime
<p>I am having trouble comparing <a href="https://metacpan.org/pod/DateTime" rel="nofollow">DateTime</a> objects in my <a href="http://www.catalystframework.org/" rel="nofollow">Catalylst</a>. I have an end_date column which is being inflated by <a href="https://metacpan.org/pod/DBIx::Class::InflateColumn::DateTime" rel="nofollow">DBIx::Class::InflateColumn::DateTime</a>, and I am inflating it with my timezone:</p> <pre><code>__PACKAGE__-&gt;add_columns( end_date =&gt; { data_type =&gt; 'datetime', time_zone =&gt; 'America/Chicago' }, ); </code></pre> <p>I have a function that is supposed to tell me if my event has closed or not, this is defined in my Schema for this class:</p> <pre><code>sub closed { my ($self) = @_; my $now = DateTime-&gt;now(time_zone =&gt; 'America/Chicago'); warn DateTime-&gt;compare($now, $self-&gt;end_date); warn $now; warn $self-&gt;end_date; return DateTime-&gt;compare($now, $self-&gt;end_date) == 1; } </code></pre> <p>However, it is not working properly. It is telling me that events have closed before they actually have. Here is an example output from the warns:</p> <pre><code>1 2014-06-29T12:20:48 2014-06-29T12:20:50 </code></pre> <p>As you can see, it is saying that the first date is greater than end_date, even though it is not. I haven't been able to figure out why this is. However, whenever I convert them and create new DateTime objects:</p> <pre><code>sub closed { my ($self) = @_; my $now = DateTime::Format::ISO8601-&gt;parse_datetime(DateTime-&gt;now(time_zone =&gt; 'America/Chicago')); my $end_date = DateTime::Format::ISO8601-&gt;parse_datetime($self-&gt;end_date); return DateTime-&gt;compare($now, $end_date) == 1; } </code></pre> <p>Then they compare correctly, and compare returns -1. Does anyone know why this could be?</p>
<p>Your debugging information is useless since you didn't include the time zone offsets (e.g. by using <code>-&gt;strftime('%FT%T%z')</code>). If you did, I bet you'll find the first date is indeed greater than the end date, and I bet it's using UTC for your inflated column.</p> <p>Looking at the docs, the time zone is to be provided by the <code>timezone</code> attribute, but you used <code>time_zone</code>.</p> <pre><code>{ data_type =&gt; 'datetime', timezone =&gt; "America/Chicago", locale =&gt; "de_DE" } </code></pre> <p>(That was a poor, confusing choice on D::C::IC::DT's behalf.)</p>