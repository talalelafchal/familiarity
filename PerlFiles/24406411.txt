Net::Telnet Waitfor not working as expected
<p>I am using <a href="https://metacpan.org/pod/Net%3a%3aTelnet" rel="nofollow"><code>Net::Telnet</code></a> to login to a networking device. </p> <p>My prompt is set to the following:</p> <pre><code>$telnetConsole = new Net::Telnet( Timeout =&gt; 5, Errmode =&gt; 'die', Prompt =&gt; '/.*(\%|\&gt;|\#|no\)) $/', ); </code></pre> <p>When I execute the following command on the console port of the networking device:</p> <pre><code>$telnetConsole-&gt;print('request virtual-chassis renumber member-id 0 new-member-id 4'); ($prematch, $match) = $telnetConsole-&gt;waitfor(Match =&gt; 'no', Errmode=&gt;'return', Timeout =&gt; 4); </code></pre> <p>It gives the following result:</p> <pre><code>root@switch&gt; request virtual-chassis renumber member-id 0 new-member-id 4 To move configuration specific to member ID 0 to member ID 4, please use the replace command. e.g. replace pattern ge-0/ with ge-4/ Do you want to continue ? [yes,no] (no) {master:0} root@switch&gt; </code></pre> <p>As you can see I get my prompt <code>root@switch&gt;</code> back, however unable to answer the sub questions <code>[yes, or no]</code>. I would like to know why Net::Telnet does not stop at the line <code>Do you want to....</code> so I can enter yes or no. It looks like I get an extra carriage return, which causes to answer "no" and returns the prompt. I also tried with "put" and separate put statement "\n" (carriage return), however no luck.</p>
<p>I fought with both Net::Telnet and Net::SSH2 ad nauseam working on a script to talk to a network device. I ended up switching to Control::CLI to make it happen. In Control::CLI, this (untested) code should work (or be darned close to it):</p> <pre><code>$telnetConsoleOutput = $telnetConsole-&gt;cmd("request virtual-chassis renumber member-id 0 new-member-id 4"); $telnetConsoleOutput = $telnetConsole-&gt;cmd("yes"); </code></pre> <p>Notice there's no "waitfor" in there? Control::CLI will handle that for you via the "cmd" function, at least that's been my experience. Control::CLI is a VERY nice little wrapper around connecting via telnet, ssh, and serial cable. I have used it to interact with Linux servers and networking gear, both SSH and serial. It handles a lot of stuff for you without you even knowing it, and feel confident it would resolve your issue with little rework on your end.</p> <p>HTH! TheJester1977</p>