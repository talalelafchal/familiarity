perl script for user interaction
<p>I'm new to programming. I have written a perl script which does the following.</p> <p>1) ssh into a remote machine</p> <p>2) execute a sequence of commands.</p> <p>The script requires user interaction in between.It needs user name and password. I'm not sure how to proceed with that.</p> <pre><code>use Net::SSH::Expect; use strict; use warnings; #login to a remote host my $ssh = Net::SSH::Expect-&gt;new (host =&gt; "ipaddr", password=&gt; 'pwd', user =&gt; 'username', raw_pty =&gt; 1); my $login_output = $ssh-&gt;login(); </code></pre> <p>The login is successful. Now, for the below scp command i'm prompted to enter the username and password of that system.The script stops here.</p> <pre><code>my $cpscp = $ssh-&gt;exec("copy scp install ip addr filename"); Enter usename for remote scp server: Enter the password for the remote server: </code></pre> <p>Once the user name is entered I need to enter the password.This is what i did but it didn't work.</p> <pre><code>my $usr = $ssh-&gt;waitfor ("Enter usename for remote scp server:\s*\z ", 5); if ($usr) { print("string found \n"); my $pwd =$ssh-&gt;send("root"); } else { print("No string found\n"); } </code></pre> <p>The script is unable to identify it. "no string found"</p> <p>I also tried the following </p> <pre><code>$ssh-&gt;waitfor('Enter username for remote scp server:\s*\z ', 5) or die "not found"; $ssh-&gt;send("root"); </code></pre>
<p>I imagine the prompt for a username has already arrived as part of the response to</p> <pre><code>my $cpscp = $ssh-&gt;exec("copy scp install ip addr filename"); </code></pre> <p>so a subsequent <code>waitfor</code> will wait for ever.</p> <p>You should use <code>send</code> with <code>waitfor</code> instead of <code>exec</code>, like this</p> <pre><code>$ssh-&gt;exec('copy scp install &lt;ip-addr&gt; &lt;remote-dir&gt; &lt;remote-filename&gt;'); my $found = $ssh-&gt;waitfor ('Enter usename for remote scp server:\s*\z', 5); </code></pre> <p>Note also that the string you use in <code>waitfor</code> is probably wrong</p> <pre><code>"Enter usename for remote scp server:\s*\z " </code></pre> <p>You have <code>usename</code> when you probably need <code>username</code>, and you have put a space at the end of the string, which is impossible because <code>\z</code> marks the end of your input and there clearly can be nothing after the end.</p> <p>It is also bad manners to post the same question to two sites simultaneously. If Perl Monks doesn't come up with a working solution for you <em>then</em> by all means ask the question here, but you are wasting our time if, unknown to us, your problem already has a solution elsewhere.</p>
<p>I imagine the prompt for username has already arrived as part of the response to the <code>exec</code></p> <pre><code>my $cpscp = $ssh-&gt;exec("copy scp install ip addr filename"); </code></pre> <p>so a subsequent <code>waitfor</code> will wait for ever.</p> <p>You should use <code>send</code> with <code>waitfor</code> instead of <code>exec</code>, like this</p> <pre><code>$ssh-&gt;exec('copy scp install &lt;ip-addr&gt; &lt;remote-dir&gt; &lt;remote-filename&gt;'); my $found = $ssh-&gt;waitfor ('Enter usename for remote scp server:\s*\z', 5); </code></pre> <p>Note also that the string you use in <code>waitfor</code> is probably wrong</p> <pre><code>"Enter usename for remote scp server:\s*\z " </code></pre> <p>You have <code>usename</code> when you probably need <code>username</code>, and you have put a space at the end of the string, which is impossible because <code>\z</code> marks the end of your input and there clearly can be nothing after the end.</p> <p>It is also bad manners to post the same question to two sites simultaneously. If Perl Monks doesn't come up with a working solution for you <em>then</em> by all means ask the question here, but you are wasting our time if, unknown to us, your problem already has a solution elsewhere.</p>