Can I close from the return of utf8::is_utf8 that a decoding layer for STDIN is set or not?
<p>Is it right to say: if a string read from <code>STDIN</code> checked with <code>utf8::is_utf8</code> returns true then there is set a decoding layer for <code>STDIN</code>?</p> <pre><code>#!/usr/bin/env perl use warnings; use strict; use 5.10.0; use open qw( :std :utf8 ); my $in = &lt;STDIN&gt;; say utf8::is_utf8( $in ) ? 'YES' : 'NO'; # YES binmode STDIN, ':bytes'; $in = &lt;STDIN&gt;; say utf8::is_utf8( $in ) ? 'YES' : 'NO'; # No binmode STDIN, ':encoding(latin1)'; $in = &lt;STDIN&gt;; say utf8::is_utf8( $in ) ? 'YES' : 'NO'; # YES </code></pre>
<p>The <code>is_utf8</code> function (whether it is from <code>utf8</code> or from <code>Encode</code>) just tells you whether a string has the internal <code>UTF8</code> flag set. That is pretty much a consequence of what you have <em>said</em> it contains yourself, and is very different from it being <em>valid</em> UTF-8.</p> <p>If you want to check the capabilities of a file handle then you should take a look at the <a href="https://metacpan.org/module/PerlIO::Layers" rel="nofollow"><code>PerlIO::Layers</code></a> module. A call like</p> <pre><code>query_handle(*STDIN, 'utf8') </code></pre> <p>will return <em>true</em> if the handle is UTF-8-capable, by setting either <code>:utf8</code> or <code>:encoding(utf8)</code>.</p> <p>If you want to check specifically for <code>:encoding(utf8)</code> then you need</p> <pre><code>query_handle(*STDIN, 'layer', 'encoding') </code></pre> <p>but note that this will show only whether there is an <code>:encoding()</code> layer of any sort, which could be <code>:encoding(iso-8859-1)</code>.</p> <p>If you really need to check <em>which</em> encoding is in place, the only way I know is to examine the return value of <code>get_layers</code> from the same module. It returns a list of arrays corresponding to the PerlIO layers in effect on the handle. Something like this</p> <pre><code>( ["unix", undef, ["CANREAD", "OPEN"]], ["encoding", "utf8", ["FASTGETS", "CANREAD", "LINEBUF", "UTF8"]], ) </code></pre>