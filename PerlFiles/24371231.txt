How to read a large number of LDAP entries in perl?
<p>I already have an LDAP script in order to read LDAP user information one by one. My problem is that I am returning all users found in Active Directory. This will not work because currently our AD has around 100,000 users causing the script to crash due to memory limitations.</p> <p>What I was thinking of doing was to try to process users by batches of X amount of users and if possible, using threads in order to process some users in parallel. The only thing is that I have just started using Perl, so I was wondering if anyone could give me a general idea of how to do this.</p>
<p>If you can get the executable <code>ldapsearch</code> to work in your environment (and it does work in *nix and Windows, although the syntax is often different), you can try something like this:</p> <pre><code>my $LDAP_SEARCH = "ldapsearch -h $LDAP_SERVER -p $LDAP_PORT -b $BASE -D uid=$LDAP_USERNAME -w $LDAP_PASSWORD -LLL"; my @LDAP_FIELDS = qw(uid mail Manager telephoneNumber CostCenter NTLogin displayName); open (LDAP, "-|:utf8", "$LDAP_SEARCH \"$FILTER\" " . join(" ", @LDAP_FIELDS)); while (&lt;LDAP&gt;) { # process each LDAP response } </code></pre> <p>I use that to read nearly 100K LDAP entries without memory problems (although it still takes 30 minutes or more). You'll need to define <code>$FILTER</code> (or leave it blank) and of course all the LDAP server/username/password pieces.</p> <p>If you want/need to do a more pure-Perl version, I've had better luck with <code>Net::LDAP</code> instead of <code>Net::LDAP::Express</code>, especially for large queries.</p>