Extract data from a subsection of a file using Shell commands or Perl
<p>I'm trying to extract information from a particular section of a file (under a certain point). More precisely, I want to be able to look for a keyword, for example "M2", and then find "Freq" under M2 to get that number without mixing up with M1 or M3. </p> <p>Most likely the easiest answer would be a combination of grep, sed, awk or cut.</p> <blockquote> <p>M1{</p> <blockquote> <p>Freq: 1GHz</p> <p>Temp: 125C</p> </blockquote> <p>}</p> <p>M2{</p> <blockquote> <p>Freq: 1.1GHz</p> <p>Temp: 130C</p> </blockquote> <p>}</p> <p>M3{</p> <blockquote> <p>Freq: 0.78GHz</p> <p>Temp: 89C</p> </blockquote> <p>}</p> </blockquote>
<p>Using a perl one-liner</p> <pre><code>perl -ne 'print $1 if /M2\{/ .. /\}/ and /Freq:\s*(.*)/' file </code></pre> <h3>Explanation:</h3> <p><strong>Switches</strong>: </p> <ul> <li><code>-n</code>: Creates a <code>while(&lt;&gt;){..}</code> loop for each &ldquo;line&rdquo; in your input file. </li> <li><code>-e</code>: Tells <code>perl</code> to execute the code on command line. </li> </ul> <p><strong>Code</strong>:</p> <ul> <li><code>/M2\{/ .. /\}/</code>: Range operator to test for between two lines</li> <li><code>/Freq:\s*(.*)/</code>: Find matching line, and capture value in <code>$1</code>.</li> </ul>
<p>Another way of doing it with <code>perl</code></p> <pre><code>perl -nle 'chomp; $str.="$_"; END{ $str =~ /M2\{.*?(Freq: .*?\s)/ &amp;&amp; print $1 }' file Freq: 1.1GHz </code></pre> <p>Explanation:</p> <ol> <li><code>chomp</code> removes <code>\n</code></li> <li><code>$str.="$_"</code> creates a string with the whole input</li> <li><code>$str =~ /M2\{.*?(Freq: .*?\s)</code> Extracts the field we're after</li> </ol>
<pre><code>perl -lane 'print $F[1] if /M2[{]/ .. /[}]/ and /Freq/' file </code></pre>
<p>Try</p> <pre><code>awk '/M2/ {found=1} found &amp;&amp; $1=="Freq:" {print $2; exit}' file </code></pre>
<p>You could use awk,</p> <pre><code>$ awk -v RS="\s*M" 'NR==3{print $3}' file 1.1GHz </code></pre>