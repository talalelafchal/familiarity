Number of rows affected after insert or ignore into
<p>The <code>perl</code> code gives me number of rows affected as 1 even though the record gets ignored by the sql statement because of <code>PRIMARY KEY CONSTRAINT</code> while inserting into a sqlite database using DBI module.</p> <pre><code>my $stmt = 'INSERT OR IGNORE INTO table1 (ID, Name) VALUES (?,?)'; my $sth = $dbh-&gt;prepare($stmt); $sth-&gt;bind_param( 1, $id, SQL_VARCHAR ); $sth-&gt;bind_param( 2, $name, SQL_VARCHAR ); my $row = $sth-&gt;execute() or die $DBI::errstr; print "Row affected for id[$id]- $row\n"; </code></pre> <p>It always gives me $row as 1 for below set of data where <code>ID &amp; NAME</code> are composite primary key-</p> <pre><code>ID NAME 1 AAA 1 BBB 1 AAA 2 BBB 2 BBB </code></pre> <p>anything wrong I am doing here. I need to execute another section of code based on value 0f $row that is 0 in case of IGNORE and 1 in case of INSERTION.</p> <p>Is there any other way to handle it? </p>
<pre><code>use strict; use warnings; use 5.016; use DBI; my $h = DBI-&gt;connect("dbi:SQLite:db=x.db"); eval { $h-&gt;do(q/drop table test/); }; $h-&gt;do(q/create table test (id integer, name varchar(10), constraint xx unique(id,name))/); my $s = $h-&gt;prepare(q/insert or ignore into test values(?,?)/); my @values = ([1, 'AAA'], [1, 'BBB'], [1, 'AAA'], [2, 'BBB'], [2, 'BBB']); foreach (@values) { my $affected = $s-&gt;execute(@{$_}); say join(",", @{$_}) . " = $affected"; } $h-&gt;disconnect; </code></pre> <p>outputs</p> <pre><code>1,AAA = 1 1,BBB = 1 1,AAA = 0E0 2,BBB = 1 2,BBB = 0E0 </code></pre> <p>for me which looks correct. I am using DBI 1.631 and DBD::SQLite 1.42.</p>