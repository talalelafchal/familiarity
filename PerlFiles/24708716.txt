Connection error using Net::IMAPClient in Perl
<p>I am trying to connect to an Outlook email server via IMAP and the error I am getting is curious. Here is a sample of my code:</p> <pre><code>use Mail::IMAPClient; my $imap = Mail::IMAPClient-&gt;new; $host='outlook.office365.com'; $username='.....'; $password='.....'; $folder='INBOX'; $imap=Mail::IMAPClient-&gt;new( Server =&gt; $host, User =&gt; $username, Password =&gt; $password, Port =&gt; 993, Ssl =&gt; 1, Clear=&gt; 5, Folder =&gt; $folder, Uid =&gt; 0, ) or die "Cannot connect to $host as $username: $@"; </code></pre> <p>When I run this, the output line looks like this:</p> <p>Cannot connect to outlook.office365.com as [...]: Socket closed while reading data from server.</p> <p>More specifically, <strong>Socket closed while reading data from server</strong> is what is confusing me.</p> <p>I specify port 993, so is the only remaining possible issue that there's a firewall in place that is preventing this? I have emailed my school's (this is a school email account) tech department (quite some time ago) and they have yet to get back, but hopefully I will hear from them soon. </p> <p>I get an even stranger error when I remove the line specifying the port, I am including it only in the hopes it is somehow relevant or helpful:</p> <p>Cannot connect to outlook.office365.com as [...]: Error sending '1 Login "baldassaren@wit.edu" {15} [password is shown here, along with a newline character I can't seem to force here] ' to IMAP: Bad file descriptor at ./test.pl line 10.</p>
<p>Please check directly with openssl:</p> <pre><code> openssl s_client -connect outlook.office365.com:993 </code></pre> <p>This should give you a connection and at the end the welcome message from the IMAP server:</p> <pre><code>* OK The Microsoft Exchange IMAP4 service is ready. .... </code></pre> <p>If this does not work the connection is blocked by firewall or so. If this works try connecting with IO::Socket::SSL, which is the module Mail::IMAPClient uses for SSL connections:</p> <pre><code>perl -MIO::Socket::SSL -e 'print IO::Socket::SSL-&gt;new(q[outlook.office365.com:993])-&gt;getline.""' </code></pre> <p>This should also give you the welcome message. If it does not there might be problems with certificate checking or so. In this case please post the versions of modules you use and the OS, e.g.</p> <pre><code>perl -e 'print "version=$^V, os=$^O\n"' perl -MIO::Socket::SSL -e 'print IO::Socket::SSL-&gt;VERSION,"\n"' perl -MMail::IMAPCient -e 'print Mail::IMAPClient-&gt;VERSION,"\n"' </code></pre> <p>But, if IO::Socket::SSL gets a successful connection please add the <code>Debug =&gt; 1</code> option to <code>Mail::IMAPClient-&gt;new</code> and add the output to your question.</p>