Parsing CSV with Text::CSV
<p>I am trying to parse a file where the header row is at row 8. From row 9-n is my data. How can I use <code>Text::CSV</code> to do this? I am having trouble, my code is below:</p> <pre><code>my @cols = @{$csv-&gt;getline($io, 8)}; my $row = {}; $csv-&gt;bind_columns (\@{$row}{@cols}); while($csv-&gt;getline($io, 8)){ my $ip_addr = $row-&gt;{'IP'}; } </code></pre>
<p>Are you dead-set on using bind_columns? I think I see what you're trying to do, and it's notionally very creative, but if all you want is a way to reference the column by the header name, how about something like this:</p> <pre><code>use strict; use warnings; use Text::CSV; my $csv = Text::CSV-&gt;new ( { binary =&gt; 1 } ); my (%header); open my $io, "&lt;", '/var/tmp/foo.csv' or die $!; while (my $row = $csv-&gt;getline ($io)) { next unless $. &gt; 7; my @fields = @$row; unless (%header) { $header{$fields[$_]} = $_ for 0..$#fields; next; } my $ip_addr = $fields[$header{'IP'}]; print "$. =&gt; $ip_addr\n"; } close $io; </code></pre> <p>Sample Input:</p> <pre><code>Test Data,,, Trash,,, Test Data,,, Trash,,, Beans,Joe,10.224.38.189,XYZ Beans,Joe,10.224.38.190,XYZ Beans,Joe,10.224.38.191,XYZ Last Name,First Name,IP,Computer Beans,Joe,10.224.38.192,XYZ Beans,Joe,10.224.38.193,XYZ Beans,Joe,10.224.38.194,XYZ Beans,Joe,10.224.38.195,XYZ Beans,Joe,10.224.38.196,XYZ Beans,Joe,10.224.38.197,XYZ </code></pre> <p>Output:</p> <pre><code>9 =&gt; 10.224.38.192 10 =&gt; 10.224.38.193 11 =&gt; 10.224.38.194 12 =&gt; 10.224.38.195 13 =&gt; 10.224.38.196 14 =&gt; 10.224.38.197 </code></pre>
<pre><code>use Text::CSV; my $csv = Text::CSV-&gt;new( ) or die "Cannot use CSV: ".Text::CSV-&gt;error_diag (); open my $io, "test.csv" or die "test.csv: $!"; my $array_ref = $csv-&gt;getline_all($io, 8); my $record = ""; foreach $record (@$array_ref) { print "$record-&gt;[0] \n"; } close $io or die "test.csv: $!"; </code></pre>