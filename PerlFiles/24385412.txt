perl mocking is there a way to mock $?
<p>I am using <a href="https://metacpan.org/pod/Test%3a%3aMockModule" rel="nofollow"><code>Test::MockModule</code></a> to test perl module. One of the call require checking status of <code>$?</code> to get error code and program checks for it.</p> <p>How can I mock the result of <code>$?</code></p> <p>Code under test is like below.</p> <pre><code>my $result = CCUtil::cleartool($cmd); if ( $? != 0 ) { confess "Stream $stream not found( $result) "; } </code></pre> <p>The api returns string and sets $? for checking status.</p> <p>Normal method calls and their return values are changed using something like below</p> <pre><code>my $module = Test::MockModule-&gt;new('CCUtil'); $mockModule-&gt;mock(cleartool =&gt; sub {return 'stream not found'}); </code></pre> <p>The method call is now mocked. Not the value of -- <code>$?</code></p>
<pre><code>my $module = Test::MockModule-&gt;new('CCUtil'); $mockModule-&gt;mock(cleartool =&gt; sub { $? = 0x0100; return 'stream not found' }); </code></pre>