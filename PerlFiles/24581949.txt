CGI::Application param() not setting
<p>I have a piece of code that uses <a href="https://metacpan.org/pod/CGI%3a%3aApplication" rel="nofollow"><code>CGI::Application</code></a> as its base, but something is not working correctly.</p> <p>When I try to set something via <code>$Template-&gt;param()</code> it seemingly does not set. <code>$Template</code> is equal to <code>$self-&gt;load_tmpl($template);</code></p> <p>And the piece I want to save is:</p> <pre><code>$Template-&gt;param('symbols' =&gt; \%a_hash_ref); </code></pre> <p>I know <code>\%a_hash_ref</code> contains the expected value. It has a similar form:</p> <pre><code>{'symbol' =&gt; 'DTX'},{'symbol' =&gt; 'QFLD'} </code></pre> <p>Also, if I do</p> <pre><code>$Template-&gt;param('Hey!xD' =&gt; 'Something'); </code></pre> <p>it doesn't save, but </p> <pre><code>$Template-&gt;param($Pagination); </code></pre> <p>does, where <code>$Pagination</code> is also a hash_ref.</p> <p>I know all the values are what they should be, and I also tried it with some simple strings, which should work, but they are not set. I know this because when I run:</p> <pre><code>my @params = $Template-&gt;param(); die Dumper \@params; </code></pre> <p>it outputs all the variables it should have set, but the expected ones(including the <code>'Hey!xD'</code> string) are missing. I also know it actually runs the code, because this die Dumper is after I try to set the values.</p> <p>The template file contains this piece of code:</p> <blockquote> $(document).ready(function () { mainFunction('[%symbol%]'); }); </blockquote> <p>Any help would be appreciated.</p> <p>EDIT:</p> <p>This is what is being given to the param:</p> <blockquote> <p>[ { 'date' => '2006-07-05', 'avg_gain' => undef, 'bollinger_mid' => '32.80000', 'symbol' => 'BBQ' }, { 'date' => '2006-04-04', 'avg_gain' => undef, 'bollinger_mid' => '34.55656', 'symbol' => 'AAPL' } ... ]</p> </blockquote>
<p>This is actually a HTML::Template problem, which CGI::Application uses by default for templating.</p> <p>Do you perhaps have <code>die_on_bad_params</code> set to 0 in your <code>load_tmpl</code> call? HTML::Template should by default die if you try to set a parameter that doesn't exist in the loaded template (<a href="https://metacpan.org/pod/HTML%3a%3aTemplate#Error-Detection-Options" rel="nofollow">docs here</a>). When <code>die_on_bad_params</code> is disabled, you'll get the behavior you're describing, where an unknown template param is ignored and discarded.</p> <p>Additionally, <a href="https://metacpan.org/pod/HTML%3a%3aTemplate#TMPL_LOOP" rel="nofollow">according to the docs</a>, <code>TMPL_LOOP</code> takes an arrayref of hashrefs as its <code>param</code> argument. Maybe it would help to pass your "symbols" parameter like this:</p> <pre><code>my $symbols = [{ symbol =&gt; 'DTX' },{ symbol =&gt; 'QFLD' }]; $Template-&gt;param(symbols =&gt; $symbols); </code></pre> <p>If you post a sample template and small script that shows the error it'll be easier to tell for certain.</p>