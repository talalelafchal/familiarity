Email::Valid trouble with utf8
<p>I need to validate some e-mail addresses that have in the From: field unicode characters like:</p> <pre><code>From: =?iso-8859-1?Q?Jos=E9_name?= &lt;J.name@domain.tld&gt; </code></pre> <p>This value gets saved in the $from variable.</p> <p>With this code </p> <pre><code>my $validator = Email::Valid-&gt;new(); my $addr = $validator-&gt;address( $from ); print $addr, "\n"; </code></pre> <p>I am getting Use of uninitialized value $addr in </p> <p>The same code works fine with values not containing unicode characters. I have tried using binmode (STDIN, ':utf8'); but that does not solve it.</p> <p>Thanks for the help!</p>
<p>As answered in the <a href="http://www.perlmonks.org/?node_id=1092570" rel="nofollow">cross post</a> mentioned by <a href="http://stackoverflow.com/users/197758/toolic">toolic</a> in the comments:</p> <blockquote> <p>The problem is that the from address is an email header part. And in a header only ASCII is valid. That's the reason why only ASCII encoded strings can be valid. Therefore the word containing the non-ascii character <code>é</code> is encoded as <code>=?iso-8859-1?Q?Jos=E9_Name?=</code>.</p> <p>When you take this byte string into the validation routine everything is fine. So, IMHO, the solution must be that you encode the unicode string representing the email address in a valid ascii representation.</p> <pre><code> #!/bin/perl use strict; use warnings; use 5.010; use Email::Valid; use Data::Dumper; use Encode qw(encode decode); my $utf8_from = decode('UTF-8', 'José &lt;J.name@web.de&gt;'); my $from = encode('MIME-Header', $utf8_from); say "Mail: $from"; my $validator = Email::Valid-&gt;new(); if(my $addr = $validator-&gt;address( $from )) { say "OK: ", Dumper($addr); } else { say "Not valid"; } </code></pre> <p>Outputs:</p> <pre><code> Mail: =?UTF-8?B?Sm9zw6kg?=&lt;J.name@web.de&gt; OK: $VAR1 = 'J.name@web.de'; </code></pre> </blockquote>