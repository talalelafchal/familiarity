CKRecords disappearing or not saving in CloudKit with Swift
I am having an issue where every user should have a CKRecord for their location in CloudKit, but only about half are present. Also, the number of records has fluctuated which means sometimes a record is deleted and not replaced or modified. Does anyone see the error in my code? My app has not been crashing or having errors. Thanks. func getRecordToUpdate(_ locations:CLLocation) { if defaults1.object(forKey: "locationData") == nil{ locationRecord.setObject(locations, forKey: "location") let id = locationRecord.recordID let dataId = NSKeyedArchiver.archivedData(withRootObject: id) defaults1.set(dataId, forKey: "locationData") self.updateLocationRecord(locations: locations) }else{ if let loadedData = defaults1.object(forKey: "locationData") as? Data { let litt = NSKeyedUnarchiver.unarchiveObject(with: loadedData) as! CKRecordID let publicDB = CKContainer.default().publicCloudDatabase publicDB.fetch(withRecordID: litt ,completionHandler: { (record, error) in if error == nil { publicDB.delete(withRecordID: (record?.recordID)!, completionHandler: { (record, error) in if(error == nil){ print("old record deleted") self.locationRecord.setObject(locations, forKey: "location") let id = self.locationRecord.recordID let dataId = NSKeyedArchiver.archivedData(withRootObject: id) self.defaults1.set(dataId, forKey: "locationData") self.updateLocationRecord(locations: locations) } else{ } }) }else{ print("Error fetching previous record") } }) } } } func updateLocationRecord(locations: CLLocation) { locationRecord.setObject(locations, forKey: "location") let publicData = CKContainer.default().publicCloudDatabase publicData.save(locationRecord, completionHandler: { record, error in }) if error == nil { print("Location saved") } }