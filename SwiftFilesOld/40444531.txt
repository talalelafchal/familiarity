Swift iOS AVVideoCapturePreviewLayer resolves to nil
In the viewDidLoad() section of my code I have this  let previewLayer = AVCaptureVideoPreviewLayer(session: captureSession) previewView.layer.addSublayer(previewLayer) however when it is called in here it resolves to nil in the compiler: func captureOutput(captureOutput: AVCaptureOutput!,didOutputSampleBuffer sampleBuffer: CMSampleBuffer!,fromConnection connection: AVCaptureConnection!) { autoreleasepool { let imageBuffer = CMSampleBufferGetImageBuffer(sampleBuffer)! let formatDescription = CMSampleBufferGetFormatDescription(sampleBuffer)! self.currentVideoDimensions = CMVideoFormatDescriptionGetDimensions(formatDescription) self.currentSampleTime = CMSampleBufferGetOutputPresentationTimeStamp(sampleBuffer) // CVPixelBufferLockBaseAddress(imageBuffer, 0) // let width = CVPixelBufferGetWidthOfPlane(imageBuffer, 0) // let height = CVPixelBufferGetHeightOfPlane(imageBuffer, 0) // let bytesPerRow = CVPixelBufferGetBytesPerRowOfPlane(imageBuffer, 0) // let lumaBuffer = CVPixelBufferGetBaseAddressOfPlane(imageBuffer, 0) // // let grayColorSpace = CGColorSpaceCreateDeviceGray() // let context = CGBitmapContextCreate(lumaBuffer, width, height, 8, bytesPerRow, grayColorSpace, CGBitmapInfo.allZeros) // let cgImage = CGBitmapContextCreateImage(context) var outputImage = CIImage(CVPixelBuffer: imageBuffer) if self.filter != nil { self.filter.setValue(outputImage, forKey: kCIInputImageKey) outputImage = self.filter.outputImage! } let orientation = UIDevice.currentDevice().orientation var t: CGAffineTransform! if orientation == UIDeviceOrientation.Portrait { t = CGAffineTransformMakeRotation(CGFloat(-M_PI / 2.0)) } else if orientation == UIDeviceOrientation.PortraitUpsideDown { t = CGAffineTransformMakeRotation(CGFloat(M_PI / 2.0)) } else if (orientation == UIDeviceOrientation.LandscapeRight) { t = CGAffineTransformMakeRotation(CGFloat(M_PI)) } else { t = CGAffineTransformMakeRotation(0) } outputImage = outputImage.imageByApplyingTransform(t) let cgImage = self.context.createCGImage(outputImage, fromRect: outputImage.extent) self.ciImage = outputImage dispatch_sync(dispatch_get_main_queue(), { self.previewLayer.contents = cgImage }) } } Does anyone have any idea why? my suspicion is that the previewLayer is created before the captureSession is instantiated, however i placed the captureSession.startRunning code in my viewDidAppear() function and it still caused a nil value. I currently have it in the viewDidLoad section now. If anyone could help it would be very much appreciated.
You're not assigning to previewLayer property. let previewLayer = AVCaptureVideoPreviewLayer(session: captureSession) previewView.layer.addSublayer(previewLayer) is supposed to be previewLayer = AVCaptureVideoPreviewLayer(session: captureSession) previewView.layer.addSublayer(previewLayer)