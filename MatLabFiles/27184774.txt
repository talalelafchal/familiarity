MATLAB-C interfacing: Access violation error on memcpy
<p>I am trying to connect a C++ code with MATLAB. I simply want to copy a variable into a MATLAB-array using memcpy. But that results in Access violation error:</p> <p>Unhandled exception at 0x009a1043 in MATLAB_C_connection.exe: 0xC0000005: Access violation writing location 0x00000000.</p> <p>Here's the C++ code I'm using:</p> <pre><code>#include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;string.h&gt; #include &lt;matrix.h&gt; #include "engine.h" #include "coupled_cfd.h" #include "mex.h" #include "mclmcr.h" #include "mclmcrrt.h" #include "mclcppclass.h" #pragma comment(lib, "libmx.lib") #pragma comment(lib, "libmat.lib") #pragma comment(lib, "libmex.lib") #pragma comment(lib, "libeng.lib") #define BUFSIZE 256 int main() { Engine *ep; mxArray *x = NULL, *result = NULL; char buffer[BUFSIZE+1]; double var[1] = {5}; double *destination; ep = engOpen(NULL); //ep = engOpen("\0"); x = mxCreateDoubleMatrix(1, 1, mxREAL); destination = mxGetPr(x); memcpy(destination, var, sizeof(double)); //engPutVariable(ep, "X", x); //engEvalString(ep, "D = X"); //engEvalString(ep, "plot(X,D)"); //engEvalString(ep, "close;"); std::cout &lt;&lt; var[0]; system("PAUSE"); mxDestroyArray(x); engClose(ep); return 1; } </code></pre> <p>The strange thing is that if I use &amp;destination in memcpy, the code compiles and works, but that is not exactly what I want. Instead, I want the value of the variable "var" to be copied into the array "x". Could anyone help me please. Many thanks, //Soheil</p>
<p>x is array type. To get a pointer to the location of a value inside the matrix array you have to specify it.</p> <p>Try <code>destination = mxGetPr(x[0]);</code> instead.</p>