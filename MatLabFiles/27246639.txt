how to multiply a matrix with every cell of cell array in Matlab?
<p>I have a 4D array <code>A</code> size(l,k,s,r) and a cell array <code>B</code> size(i,j) where in each cell a different 4D array of coefficients size(l,k,s,r) is stored.</p> <p>I want to make changes in the given array <code>C</code> of size(i,j) = <code>C(i,j) + sum(sum(sum(sum(A.*B{i,j}))))</code> without <code>for</code> loop.</p> <p>in other words I need to extract one by one all arrays out of cell array <code>B</code> and multiply with <code>A</code>.</p> <p>with the for loop i do it this way:</p> <pre><code>for i=1:length_of_first_dimension for j=1:length_of_second_dimension B_4D=B{i,j}; % extraction of 4D array dummy(i,j)=sum(sum(sum(sum(B_4D.*A)))); end end C=C+dummy; </code></pre> <p>can anyone help me with that?</p>
<p>first, <a href="http://www.mathworks.com/help/matlab/ref/reshape.html" rel="nofollow"><code>reshape</code></a> <code>B</code> into a <code>(length_of_first_dimension*length_of_second_dimension)</code>-by-<code>l*k*s*r</code> 2D matrix</p> <pre><code>rB = cellfun( @(x) x(:).', B, 'uni', 0 ); %' rB = vertcat(rB{:}); </code></pre> <p>Now, <code>reshape</code> <code>A</code> into a <code>l*k*s*r</code>-by-1 column vector</p> <pre><code>rA = A(:); </code></pre> <p>And simply multiply them</p> <pre><code>rDummy = rB * rA; %// does the elem-wise product and summation quite quickly. </code></pre> <p>Reshape the result</p> <pre><code>dummy = reshape(rDummy, size(B) ); C = C + dummy; </code></pre> <hr> <p>As pointed by <a href="http://stackoverflow.com/questions/27246639/how-to-multiply-a-matrix-with-every-cell-of-cell-array-in-matlab/27246868#comment42974119_27246868">Divakar</a> a more efficient way to <code>reshape</code> <code>B</code> would be</p> <pre><code>rB = reshape( cat( 5, B{:} ), numel(A), [] ).'; </code></pre> <p>And a small benchmark can be found <a href="https://ideone.com/SI59SI" rel="nofollow">here</a>.</p>