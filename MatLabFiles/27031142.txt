Average values in one column when another column repeats
<p>I have a table in MATLAB that looks something like this (just for illustration purposes. Numbers are not necessarily correct): </p> <pre><code>Monitor ID POC Latitude Longitude Date Local Mean Date Num '01-003-0010-88101' 1 30.498001 -87.881412 1/1/2012 6.7 734869 '01-003-0010-88101' 3 30.498001 -87.881412 1/4/2012 9 734872 '01-003-0010-88101' 1 30.498001 -87.881412 1/7/2012 6.5 734875 '01-073-0023-88101' 1 33.447867 -117.088649 1/22/2012 8 734890 '01-073-0023-88101' 3 33.447867 -117.088649 1/22/2012 6 734890 '01-073-0023-88101' 9 33.447867 -117.088649 1/22/2012 9.6 734890 </code></pre> <p>The full table, which has more columns, can be found here: <a href="https://www.dropbox.com/s/q6psz0eqhf1c7gl/data_PM25_table.mat.mat?dl=0" rel="nofollow">https://www.dropbox.com/s/q6psz0eqhf1c7gl/data_PM25_table.mat.mat?dl=0</a></p> <p>What I want to do is, if the data came from the same place on the same day, then average the last column (the Arithmetic Mean). </p> <p>So if the Monitor ID repeats when the Date Num is the same (i.e., one monitor has more than one value on a particular day, average the Arithmetic Means. </p> <p>The table I gave above has two examples to illustrate what I mean. </p> <ul> <li><p>The first three rows are ones I would leave alone - The date is different so this is data from three different days. I would just add a new colomn with the number '1' POC on each of these days. </p></li> <li><p>The three rows after that however, has the same dates with different POC values. In such a case, I would average the three mean values since the measurements came from the same place on the same day.</p></li> </ul> <p>I'd like to only keep one of the rows that has data from the same place on the same day. </p> <p>So after processing, I want the table (can be a new table) will look like this:</p> <pre><code>Monitor ID POC Latitude Longitude Date Local Mean Date Num Counter '01-003-0010-88101' 1 30.498001 -87.881412 1/1/2012 6.7 734869 1 '01-003-0010-88101' 3 30.498001 -87.881412 1/4/2012 9 734872 1 '01-003-0010-88101' 1 30.498001 -87.881412 1/7/2012 6.5 734875 1 '01-073-0023-88101' 1 33.447867 -117.088649 1/22/2012 7.9 734890 3 </code></pre> <p>How can I do this? </p>
<p>Instead of trying to do this with an entire table, pull out each site separately. Then, sort the dates, find where these dates repeat and how many times. With that, the average can be easily found.</p> <pre><code>for m = 1:length(u_id) % Run through one site at a time k = u_id(m); % Site under consideration ind1 = find(strcmp(data_PM25.MonitorID, k) == 1); % Find where a site has data d1 = data_PM25(ind1,:); % Data set with only one site [dates_sort ind_sort] = sort(cell2mat(d1.DateNum)); % Sort the dates d1 = d1(ind_sort,:); % Make sure the entire table is sorted in the same way [aa, ii, jj] = unique(dates_sort,'legacy'); % Unique dates n = diff([0; ii]); % Find how many times each monitor repeats on one day result = accumarray(jj,vertcat(d1.ArithmeticMean(ind_sort)))./n; % Data in repeated rows are summed and divided by the number of repetitions to obtain the averages d2 = d1(ii,:); % Create dataset with only the average of the arithmetic means d2.ArithmeticMean = result; % Set the Arithmetic Mean to the new averaged mean over all POCs at a site on a particular day d2.NumberOfPOCs = n; % Number of POCs being averaged together end </code></pre>