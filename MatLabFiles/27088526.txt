xcorr versus finddelay for finding delay between signals
<p>Calculating the time delay between the two pulses illustrated <a href="http://postimg.org/image/bsorzgt1z/" rel="nofollow">here</a>, using the function <code>finddelay(pulse1,pulse2)</code>, I get the correct value of 8.73 nsec. However when I use <code>xcorr(pulse1,pulse2)</code>, the result is about 11.2 nsec... What am I doing wrong here? </p> <p>xcorr:</p> <pre><code>r=xcorr(pulse1,pulse2); [a,b]=max(r); delay=20/4096*b; </code></pre> <p><a href="http://postimg.org/image/egdeiaian/" rel="nofollow">here's</a> the plot for the cross correlation</p> <p>finddelay:</p> <pre><code>delay=finddelay(v1,v2); t=20/4096*delay; </code></pre> <p>In the first case delay=2308 and in the second one delay=1788</p>
<p>As implied by the answer above, your error is with your use of xcorr. You need to ask for both the "c" values and for the "lags":</p> <pre><code>[c,lags]=xcorr(pulse1,pulse2); %do the cross-correlation [max_c,I]=max(x); %find the best correlation delay = lags(I); %here is the delay in samples </code></pre>
<p>In your question you haven't mentioned sampling frequency since the <code>finddelay</code> and <code>xcorr</code> will give you the delay in number of samples.</p> <p>Check this example,</p> <pre><code>Fs = 100; L = 1000; t = (-L / 2 : 1 : L / 2) / Fs; y1 = sinc(t); y2 = sinc(t - 1); plot(t,y1,'b'); hold on; plot(t,y2,'m'); d1 = finddelay(y1,y2) / Fs; [c,lags]=xcorr(y1,y2); d2 = -(lags(c == max(c))) / Fs; % minus is for nature of xcorr </code></pre> <p><img src="https://i.stack.imgur.com/oA504.png" alt="enter image description here"></p> <p>Where the answer for both <code>d1</code> and <code>d2</code> is <code>1</code>.</p>