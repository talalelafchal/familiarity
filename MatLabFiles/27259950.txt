Understanding Java Callbacks/Events in Matlab
<p>I am trying to understand more fundamentally what is happening when adding listeners in Matlab to java objects. See <a href="http://undocumentedmatlab.com/blog/matlab-callbacks-for-java-events" rel="nofollow">here</a> for original discussion.</p> <p>Below is an java src for setting up the callback</p> <pre><code>public class Handler { public Listener object; public class Event extends java.util.EventObject { public double d1,d2,d3; Event(Object obj, double d1, double d2, double d3) { super(obj); this.d1 = d1; this.d2 = d2; this.d3 = d3; }} public interface Listener extends java.util.EventListener { // the function call matlab proxy obj implements void measurement(Event event); } public void addListener (Listener listener) { System.out.println("listener has been added"); this.object = listener; } public void removeListener(Listener listener) { System.out.println("listener has been removed"); this.object = null; } // wrapper function (i.e. what actually exposed/called/used) public void measurement(double temp, double pressure, double height) { this.object.measurement( new Event(this, temp, pressure, height) ); System.out.println("listener has been notified"); } } </code></pre> <p>Then in Matlab (2014b) can set up the Java --> Matlab callback as </p> <pre><code>% create Handler java object in matlab handler = com.callback.Handler(); % add a listener for interface function measurement(e) addlistener(handler,'measurement',@(h,e)disp(e.d1+e.d2+e.d3)); % call the wrapper function manually to test setup handler.measurement(1,2,3); </code></pre> <p>Some idea of the initial setup of Matlab's <code>addlistener</code> call is performed by</p> <pre><code> /toolbox/matlab/uitools/private/javaaddlistener.m </code></pre> <p>When calling <code>addlistener</code> in Matlab I get the message on the command window that</p> <blockquote> <p>listener has been added</p> </blockquote> <p>from the <code>addListener</code> function in <code>Handler</code>. So here Matlab has dynamically created an object which implements <code>Listener</code> interface and has called </p> <pre><code>handler.addListener(mysteryObj); </code></pre> <p>I can try to see what Matlab put there with</p> <pre><code>&gt;&gt; handler.object </code></pre> <p>which returns </p> <blockquote> <p>com.mathworks.MLEventAdapters.com.callback.Handler$ListenerLIAdapterClass@45a37759</p> </blockquote> <p>which I guess is some kind of dynamically created <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Proxy.html" rel="nofollow">proxy</a> object?</p> <p>The most vexing issues here is that once I look at <code>&gt;&gt; handler.object</code> suddenly I see the message</p> <blockquote> <p>listener has been removed</p> </blockquote> <p>but why?? This means Matlab automatically called </p> <pre><code>handler.removeListener(mysteryObj) </code></pre> <p>here? </p> <p>At any rate, I started looking through com.mathworks.jmi but that's going to take a while and I'm not even certain the answer is there ... any help would be great.</p>