Subsetting array of dates according to recessions in Matlab
<p>I would like to subset an array of serial numbers representing dates, according to recession periods, so that I can calculate <code>mean()</code> over these periods. The following example illustrate this:</p> <pre><code>DateArray = transpose((1:20000)+678420); RndData = normrnd(0.003,0.05,19999,1); CumData = cumprod([1;RndData+1]); Data = [DateArray CumData]; load Data_Recessions.mat %Native `Econometrics toolbox` dataset % This loads a 2 column double array of start dates in the first column and corresponding end dates in the second column. plot(Data(:,1),Data(:,2)) set(gca(),'Yscale','log'); recessionplot() </code></pre> <p><img src="https://i.stack.imgur.com/SsMkU.jpg" alt="enter image description here"></p> <p>I thus want to calculate mean() over the grey bars above. The dates indicating these periods are in the Recessions array. How do I do this most efficiently?</p>
<p>This will give you the average in grey as well as white periods. It builds an index to be used as label for each data value, and then applies <a href="http://es.mathworks.com/help/matlab/ref/accumarray.html" rel="nofollow"><code>accumarray</code></a> to average all values with the same label:</p> <pre><code>ind = sum(bsxfun(@ge, Data(:,1).', [0; reshape(Date_Recessions.',[],1)]),1) result = accumarray(ind(:), Data(:,2), [], @mean); </code></pre>
<p>Assuming your recession dates are in a 2 column matrix called D</p> <pre><code>M = arrayfun(@(x)(mean(Data(find(Data(:,1)==D(x,1)):find(Data(:,1)==D(x,2)),2))), 1:size(D,1)) </code></pre> <p>Or as a for loop which is actually probably more efficient:</p> <pre><code>M = NaN(size(D,1),1); for x = 1:size(D,1) first = find(Data(:,1)==D(x,1)) last = find(Data(:,1)==D(x,2)) M(x) = mean(Data(first:last, 2)) end </code></pre>